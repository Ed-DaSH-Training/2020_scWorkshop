<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>16 Advanced Topics: Pseudotime Cell Trajectories | ANALYSIS OF SINGLE CELL RNA-SEQ DATA</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="16 Advanced Topics: Pseudotime Cell Trajectories | ANALYSIS OF SINGLE CELL RNA-SEQ DATA" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://broadinstitute.github.io/2020_scWorkshop/" />
  <meta property="og:image" content="https://broadinstitute.github.io/2020_scWorkshop/images/cover.png" />
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="broadinstitute/2019_scWorkship" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="16 Advanced Topics: Pseudotime Cell Trajectories | ANALYSIS OF SINGLE CELL RNA-SEQ DATA" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="twitter:image" content="https://broadinstitute.github.io/2020_scWorkshop/images/cover.png" />

<meta name="author" content="Orr Ashenberg" />
<meta name="author" content="Dana Silverbush" />
<meta name="author" content="Kirk Gosik" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="acknowledgements.html"/>
<link rel="next" href="single-cell-resources.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ANALYSIS OF SINGLE CELL RNA-SEQ DATA</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-overview"><i class="fa fa-check"></i><b>1.1</b> COURSE OVERVIEW</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#targeted-audience-assumed-background"><i class="fa fa-check"></i><b>1.2</b> TARGETED AUDIENCE &amp; ASSUMED BACKGROUND</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#course-format"><i class="fa fa-check"></i><b>1.3</b> COURSE FORMAT</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#getting-started"><i class="fa fa-check"></i><b>1.4</b> Getting Started</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#session-content"><i class="fa fa-check"></i><b>1.5</b> SESSION CONTENT</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#monday-classes-from-0800-to-1600-lunch-break-1-hr-40-min-of-total-coffee-breaks"><i class="fa fa-check"></i><b>1.5.1</b> Monday – Classes from 08:00 to 16:00 (lunch break-1 hr, 40 min of total coffee breaks)</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#tuesday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.2</b> Tuesday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#wednesday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.3</b> Wednesday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.4" data-path="index.html"><a href="index.html#thursday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.4</b> Thursday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.5" data-path="index.html"><a href="index.html#friday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.5</b> Friday – Classes from 08:00 to 16:00</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="experimental-design.html"><a href="experimental-design.html"><i class="fa fa-check"></i><b>2</b> Experimental Design</a><ul>
<li class="chapter" data-level="2.1" data-path="experimental-design.html"><a href="experimental-design.html#slides"><i class="fa fa-check"></i><b>2.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html"><i class="fa fa-check"></i><b>3</b> Understanding Sequencing Raw Data</a><ul>
<li class="chapter" data-level="3.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#class-environment"><i class="fa fa-check"></i><b>3.1</b> Class Environment</a><ul>
<li class="chapter" data-level="3.1.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#getting-into-aws-instance"><i class="fa fa-check"></i><b>3.1.1</b> Getting into AWS Instance</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#shell-and-unix-commands"><i class="fa fa-check"></i><b>3.2</b> Shell and Unix commands</a><ul>
<li class="chapter" data-level="3.2.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#common-linux-commands"><i class="fa fa-check"></i><b>3.2.1</b> Common Linux Commands</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#file-formats"><i class="fa fa-check"></i><b>3.3</b> File formats</a><ul>
<li class="chapter" data-level="3.3.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#view-fastq-files"><i class="fa fa-check"></i><b>3.3.1</b> View FASTQ Files</a></li>
<li class="chapter" data-level="3.3.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#view-bam-files"><i class="fa fa-check"></i><b>3.3.2</b> View BAM Files</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#public-data-repositories"><i class="fa fa-check"></i><b>3.4</b> Public data repositories</a><ul>
<li class="chapter" data-level="3.4.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#cellranger10x"><i class="fa fa-check"></i><b>3.4.1</b> Cellranger/10x</a></li>
<li class="chapter" data-level="3.4.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#geo"><i class="fa fa-check"></i><b>3.4.2</b> GEO</a></li>
<li class="chapter" data-level="3.4.3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#single-cell-portal"><i class="fa fa-check"></i><b>3.4.3</b> Single Cell Portal</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#docker-commands"><i class="fa fa-check"></i><b>3.5</b> Docker Commands</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="transcriptome-quantification.html"><a href="transcriptome-quantification.html"><i class="fa fa-check"></i><b>4</b> Transcriptome Quantification</a><ul>
<li class="chapter" data-level="4.1" data-path="transcriptome-quantification.html"><a href="transcriptome-quantification.html#google-slides"><i class="fa fa-check"></i><b>4.1</b> Google Slides</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html"><i class="fa fa-check"></i><b>5</b> Processing scRNAseq Data</a><ul>
<li class="chapter" data-level="5.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#goal"><i class="fa fa-check"></i><b>5.1</b> Goal</a></li>
<li class="chapter" data-level="5.2" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#further-reading"><i class="fa fa-check"></i><b>5.2</b> Further reading</a></li>
<li class="chapter" data-level="5.3" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#download-data"><i class="fa fa-check"></i><b>5.3</b> Download data</a><ul>
<li class="chapter" data-level="5.3.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#fastq-file-format"><i class="fa fa-check"></i><b>5.3.1</b> Fastq file format</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#align-the-reads"><i class="fa fa-check"></i><b>5.4</b> Align the reads</a><ul>
<li class="chapter" data-level="5.4.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#star-align"><i class="fa fa-check"></i><b>5.4.1</b> STAR align</a></li>
<li class="chapter" data-level="5.4.2" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#bam-file-format"><i class="fa fa-check"></i><b>5.4.2</b> Bam file format</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#visualization"><i class="fa fa-check"></i><b>5.5</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html"><i class="fa fa-check"></i><b>6</b> Introduction R/Bioconductor</a><ul>
<li class="chapter" data-level="6.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#start-environment"><i class="fa fa-check"></i><b>6.1</b> Start Environment</a><ul>
<li class="chapter" data-level="6.1.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#local-command"><i class="fa fa-check"></i><b>6.1.1</b> Local Command</a></li>
<li class="chapter" data-level="6.1.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#aws-command"><i class="fa fa-check"></i><b>6.1.2</b> AWS Command</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#installing-packages"><i class="fa fa-check"></i><b>6.2</b> Installing packages</a><ul>
<li class="chapter" data-level="6.2.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#cran"><i class="fa fa-check"></i><b>6.2.1</b> CRAN</a></li>
<li class="chapter" data-level="6.2.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#github"><i class="fa fa-check"></i><b>6.2.2</b> Github</a></li>
<li class="chapter" data-level="6.2.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#bioconductor"><i class="fa fa-check"></i><b>6.2.3</b> Bioconductor</a></li>
<li class="chapter" data-level="6.2.4" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#source"><i class="fa fa-check"></i><b>6.2.4</b> Source</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#installation-instructions"><i class="fa fa-check"></i><b>6.3</b> Installation instructions:</a><ul>
<li class="chapter" data-level="6.3.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#classestypes"><i class="fa fa-check"></i><b>6.3.1</b> Classes/Types</a></li>
<li class="chapter" data-level="6.3.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#data-structures"><i class="fa fa-check"></i><b>6.3.2</b> Data structures</a></li>
<li class="chapter" data-level="6.3.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#detour-to-s3s4"><i class="fa fa-check"></i><b>6.3.3</b> Detour to S3/S4</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#more-information"><i class="fa fa-check"></i><b>6.4</b> More information</a><ul>
<li class="chapter" data-level="6.4.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#checking-for-help-for-any-function"><i class="fa fa-check"></i><b>6.4.1</b> Checking for help for any function!</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#grammer-of-graphics-ggplot2"><i class="fa fa-check"></i><b>6.5</b> Grammer of Graphics (ggplot2)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#what-is-ggplot2"><i class="fa fa-check"></i><b>6.5.1</b> What is ggplot2?</a></li>
<li class="chapter" data-level="6.5.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#principles-of-ggplot2"><i class="fa fa-check"></i><b>6.5.2</b> Principles of ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#reference"><i class="fa fa-check"></i><b>6.6</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>7</b> Quality Control</a><ul>
<li class="chapter" data-level="7.1" data-path="quality-control.html"><a href="quality-control.html#slides-1"><i class="fa fa-check"></i><b>7.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html"><i class="fa fa-check"></i><b>8</b> Data Wrangling scRNAseq</a><ul>
<li class="chapter" data-level="8.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#goal-1"><i class="fa fa-check"></i><b>8.1</b> Goal</a></li>
<li class="chapter" data-level="8.2" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#introduction-1"><i class="fa fa-check"></i><b>8.2</b> Introduction</a><ul>
<li class="chapter" data-level="8.2.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#load-necessary-packages"><i class="fa fa-check"></i><b>8.2.1</b> Load necessary packages</a></li>
<li class="chapter" data-level="8.2.2" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#read-in-nsclc-counts-matrix."><i class="fa fa-check"></i><b>8.2.2</b> Read in NSCLC counts matrix.</a></li>
<li class="chapter" data-level="8.2.3" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#lets-examine-the-sparse-counts-matrix"><i class="fa fa-check"></i><b>8.2.3</b> Let’s examine the sparse counts matrix</a></li>
<li class="chapter" data-level="8.2.4" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#how-big-is-the-matrix"><i class="fa fa-check"></i><b>8.2.4</b> How big is the matrix?</a></li>
<li class="chapter" data-level="8.2.5" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#how-much-memory-does-a-sparse-matrix-take-up-relative-to-a-dense-matrix"><i class="fa fa-check"></i><b>8.2.5</b> How much memory does a sparse matrix take up relative to a dense matrix?</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#filtering-low-quality-cells"><i class="fa fa-check"></i><b>8.3</b> Filtering low-quality cells</a><ul>
<li class="chapter" data-level="8.3.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#look-at-the-summary-counts-for-genes-and-cells"><i class="fa fa-check"></i><b>8.3.1</b> Look at the summary counts for genes and cells</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#plot-cells-ranked-by-their-number-of-detected-genes."><i class="fa fa-check"></i><b>8.3.2</b> Plot cells ranked by their number of detected genes.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#beginning-with-seurat-httpsatijalab.orgseurat"><i class="fa fa-check"></i><b>8.4</b> Beginning with Seurat: <span>http://satijalab.org/seurat/</span></a><ul>
<li class="chapter" data-level="8.4.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#creating-a-seurat-object"><i class="fa fa-check"></i><b>8.4.1</b> Creating a seurat object</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#preprocessing-step-1-filter-out-low-quality-cells"><i class="fa fa-check"></i><b>8.5</b> Preprocessing step 1 : Filter out low-quality cells</a></li>
<li class="chapter" data-level="8.6" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#examine-contents-of-seurat-object"><i class="fa fa-check"></i><b>8.6</b> Examine contents of Seurat object</a><ul>
<li class="chapter" data-level="8.6.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#preprocessing-step-2-expression-normalization"><i class="fa fa-check"></i><b>8.6.1</b> Preprocessing step 2 : Expression normalization</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#detection-of-variable-genes-across-the-single-cells"><i class="fa fa-check"></i><b>8.7</b> Detection of variable genes across the single cells</a></li>
<li class="chapter" data-level="8.8" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#gene-set-expression-across-cells"><i class="fa fa-check"></i><b>8.8</b> Gene set expression across cells</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="identifying-cell-populations.html"><a href="identifying-cell-populations.html"><i class="fa fa-check"></i><b>9</b> Identifying Cell Populations</a><ul>
<li class="chapter" data-level="9.1" data-path="identifying-cell-populations.html"><a href="identifying-cell-populations.html#slides-2"><i class="fa fa-check"></i><b>9.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html"><i class="fa fa-check"></i><b>10</b> Feature Selection and Cluster Analysis</a><ul>
<li class="chapter" data-level="10.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#abstract"><i class="fa fa-check"></i><b>10.1</b> Abstract</a></li>
<li class="chapter" data-level="10.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#seurat-tutorial-redo"><i class="fa fa-check"></i><b>10.2</b> Seurat Tutorial Redo</a><ul>
<li class="chapter" data-level="10.2.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#preprocessing-steps"><i class="fa fa-check"></i><b>10.2.1</b> Preprocessing Steps</a></li>
<li class="chapter" data-level="10.2.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#start-of-identifying-cell-types"><i class="fa fa-check"></i><b>10.2.2</b> Start of Identifying Cell Types</a></li>
<li class="chapter" data-level="10.2.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#run-non-linear-dimensional-reduction-umaptsne"><i class="fa fa-check"></i><b>10.2.3</b> Run non-linear dimensional reduction (UMAP/tSNE)</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#feature-selection"><i class="fa fa-check"></i><b>10.3</b> Feature Selection</a><ul>
<li class="chapter" data-level="10.3.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#differential-expression-analysis"><i class="fa fa-check"></i><b>10.3.1</b> Differential Expression Analysis</a></li>
<li class="chapter" data-level="10.3.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#check-clusters"><i class="fa fa-check"></i><b>10.3.2</b> Check Clusters</a></li>
<li class="chapter" data-level="10.3.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#view-entire-object-structure"><i class="fa fa-check"></i><b>10.3.3</b> View Entire Object Structure</a></li>
<li class="chapter" data-level="10.3.4" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#practice-visualizingembedding"><i class="fa fa-check"></i><b>10.3.4</b> Practice Visualizing/Embedding</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#other-options-for-analysis"><i class="fa fa-check"></i><b>10.4</b> Other Options For Analysis</a></li>
<li class="chapter" data-level="10.5" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#load-settings-and-packages"><i class="fa fa-check"></i><b>10.5</b> Load settings and packages</a></li>
<li class="chapter" data-level="10.6" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#read-in-pancreas-expression-matrices"><i class="fa fa-check"></i><b>10.6</b> Read in pancreas expression matrices</a></li>
<li class="chapter" data-level="10.7" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#preparing-the-individual-seurat-objects-for-each-pancreas-dataset-without-batch-correction"><i class="fa fa-check"></i><b>10.7</b> Preparing the individual Seurat objects for each pancreas dataset without batch correction</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="cluster-pancreatic-datasets-without-batch-correction.html"><a href="cluster-pancreatic-datasets-without-batch-correction.html"><i class="fa fa-check"></i><b>11</b> Cluster pancreatic datasets without batch correction</a><ul>
<li class="chapter" data-level="11.0.1" data-path="cluster-pancreatic-datasets-without-batch-correction.html"><a href="cluster-pancreatic-datasets-without-batch-correction.html#batch-correction-canonical-correlation-analysis-cca-mutual-nearest-neighbors-mnn-using-seurat-v3"><i class="fa fa-check"></i><b>11.0.1</b> Batch correction: canonical correlation analysis (CCA)+ mutual nearest neighbors (MNN) using Seurat v3</a></li>
<li class="chapter" data-level="11.0.2" data-path="cluster-pancreatic-datasets-without-batch-correction.html"><a href="cluster-pancreatic-datasets-without-batch-correction.html#batch-correction-integrative-non-negative-matrix-factorization-nmf-using-liger"><i class="fa fa-check"></i><b>11.0.2</b> Batch correction: integrative non-negative matrix factorization (NMF) using LIGER</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="additional-exploration-regressing-out-unwanted-covariates.html"><a href="additional-exploration-regressing-out-unwanted-covariates.html"><i class="fa fa-check"></i><b>12</b> Additional exploration: Regressing out unwanted covariates</a></li>
<li class="chapter" data-level="13" data-path="additional-exploration-kbet.html"><a href="additional-exploration-kbet.html"><i class="fa fa-check"></i><b>13</b> Additional exploration: kBET</a></li>
<li class="chapter" data-level="14" data-path="additional-exploration-seurat-3.html"><a href="additional-exploration-seurat-3.html"><i class="fa fa-check"></i><b>14</b> Additional exploration: Seurat 3</a></li>
<li class="chapter" data-level="15" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i><b>15</b> Acknowledgements</a></li>
<li class="chapter" data-level="16" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html"><i class="fa fa-check"></i><b>16</b> Advanced Topics: Pseudotime Cell Trajectories</a><ul>
<li class="chapter" data-level="16.1" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#slides-3"><i class="fa fa-check"></i><b>16.1</b> Slides</a></li>
<li class="chapter" data-level="16.2" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#load-settings-and-packages-1"><i class="fa fa-check"></i><b>16.2</b> Load settings and packages</a></li>
<li class="chapter" data-level="16.3" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#first-look-at-the-differentiation-data-from-deng-et-al."><i class="fa fa-check"></i><b>16.3</b> First look at the differentiation data from Deng et al.</a></li>
<li class="chapter" data-level="16.4" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#principle-components-analysis"><i class="fa fa-check"></i><b>16.4</b> Principle Components Analysis</a></li>
<li class="chapter" data-level="16.5" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#diffusion-map-pseudotime"><i class="fa fa-check"></i><b>16.5</b> Diffusion map pseudotime</a></li>
<li class="chapter" data-level="16.6" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#slingshot-map-pseudotime"><i class="fa fa-check"></i><b>16.6</b> Slingshot map pseudotime</a></li>
<li class="chapter" data-level="16.7" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#find-temporally-expressed-genes"><i class="fa fa-check"></i><b>16.7</b> Find temporally expressed genes</a></li>
<li class="chapter" data-level="16.8" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#comparison-of-the-different-trajectory-inference-methods"><i class="fa fa-check"></i><b>16.8</b> Comparison of the different trajectory inference methods</a></li>
<li class="chapter" data-level="16.9" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#plots-of-gene-expression-over-time."><i class="fa fa-check"></i><b>16.9</b> Plots of gene expression over time.</a></li>
<li class="chapter" data-level="16.10" data-path="advanced-topics-pseudotime-cell-trajectories.html"><a href="advanced-topics-pseudotime-cell-trajectories.html#acknowledgements-1"><i class="fa fa-check"></i><b>16.10</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="single-cell-resources.html"><a href="single-cell-resources.html"><i class="fa fa-check"></i><b>17</b> Single Cell Resources</a><ul>
<li class="chapter" data-level="17.1" data-path="single-cell-resources.html"><a href="single-cell-resources.html#comprehensive-list-of-single-cell-resources"><i class="fa fa-check"></i><b>17.1</b> Comprehensive list of single-cell resources</a></li>
<li class="chapter" data-level="17.2" data-path="single-cell-resources.html"><a href="single-cell-resources.html#computational-packages-for-single-cell-analysis"><i class="fa fa-check"></i><b>17.2</b> Computational packages for single-cell analysis</a></li>
<li class="chapter" data-level="17.3" data-path="single-cell-resources.html"><a href="single-cell-resources.html#elife-commentary-on-the-human-cell-atlas"><i class="fa fa-check"></i><b>17.3</b> eLife Commentary on the Human Cell Atlas</a></li>
<li class="chapter" data-level="17.4" data-path="single-cell-resources.html"><a href="single-cell-resources.html#online-courses"><i class="fa fa-check"></i><b>17.4</b> Online courses</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ANALYSIS OF SINGLE CELL RNA-SEQ DATA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-topics-pseudotime-cell-trajectories" class="section level1">
<h1><span class="header-section-number">16</span> Advanced Topics: Pseudotime Cell Trajectories</h1>
<div id="slides-3" class="section level2">
<h2><span class="header-section-number">16.1</span> Slides</h2>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb245-1"></a><span class="kw">library</span>(Seurat)</span>
<span id="cb245-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb245-2"></a>pbmc_small<span class="op">@</span>assays<span class="op">$</span>RNA<span class="op">@</span>counts[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## 230 x 10 sparse Matrix of class &quot;dgCMatrix&quot;</code></pre>
<pre><code>##    [[ suppressing 10 column names &#39;ATGCCAGAACGACT&#39;, &#39;CATGGCCTGTGCAT&#39;, &#39;GAACCTGATGAACC&#39; ... ]]
##    [[ suppressing 10 column names &#39;ATGCCAGAACGACT&#39;, &#39;CATGGCCTGTGCAT&#39;, &#39;GAACCTGATGAACC&#39; ... ]]</code></pre>
<pre><code>##                                       
## MS4A1         . .  .  .  . . .  . .  .
## CD79B         1 .  .  .  . . .  . .  1
## CD79A         . .  .  .  . . .  . .  .
## HLA-DRA       . 1  .  .  1 1 .  1 .  .
## TCL1A         . .  .  .  . . .  . .  .
## HLA-DQB1      1 .  .  .  . . .  . .  .
## HVCN1         . .  .  .  . . .  . .  .
## HLA-DMB       . .  .  .  . . .  . .  .
## LTB           3 7 11 13  3 4 6  4 2 21
## LINC00926     . .  .  .  . . .  . .  .
## FCER2         . .  .  .  . . .  . .  .
## SP100         1 .  1  1  . . .  . .  1
## NCF1          . .  .  .  . . .  . .  .
## PPP3CC        . .  .  .  . 1 .  . .  .
## EAF2          . .  .  .  . . .  . .  .
## PPAPDC1B      . .  .  .  . . .  . .  .
## CD19          . .  .  .  . . .  . .  .
## KIAA0125      . .  .  .  . . .  . .  .
## CYB561A3      . .  .  .  . . .  . .  .
## CD180         . .  .  .  . . .  . .  .
## RP11-693J15.5 . .  .  .  . . .  . .  .
## FAM96A        . 1  .  .  . . .  . .  .
## CXCR4         1 1  .  6  . 2 4  1 .  4
## STX10         . .  1  .  . 1 .  1 .  .
## SNHG7         . 2  .  .  . . .  . .  1
## NT5C          . .  .  .  . . .  . .  .
## BANK1         . 1  .  .  . . .  . .  .
## IGLL5         . .  .  .  . . .  . .  .
## CD200         . .  .  .  . . .  . .  .
## FCRLA         . .  .  .  . . .  . .  .
## CD3D          4 4  4  5  4 4 3  2 2  2
## NOSIP         . 3  2  2  3 1 1  3 2  1
## SAFB2         . 1  .  1  . 1 1  . .  1
## CD2           1 .  2  2  . 1 .  1 2  1
## IL7R          5 2  1  2  2 . 1 12 .  9
## PIK3IP1       . .  1  .  . 2 3  2 3  .
## MPHOSPH6      1 1  .  .  . . 1  1 1  1
## KHDRBS1       . 1  1  1 36 . .  . .  .
## MAL           1 1  .  1  . . .  1 .  1
## CCR7          . 5  .  .  2 . 1  1 .  1
## THYN1         . 2  1  1  . 2 1  . 1  .
## TAF7          . 2  .  2  1 2 .  2 3  1
## LDHB          3 2  1  6  5 3 4  . 1  6
## TMEM123       3 3  .  4  2 1 1  2 1  1
## CCDC104       . .  .  2  . 1 .  1 .  .
## EPC1          1 .  1  .  . 1 .  1 1  1
## EIF4A2        3 1  2  5  2 4 3  2 3  .
## CD3E          . 2  1  4  3 1 3  4 2  .
## TMUB1         1 .  .  .  . 1 1  1 .  .
## BLOC1S4       1 .  2  .  2 . .  . 1  .
## 
##  ..............................
##  ........suppressing 130 rows in show(); maybe adjust &#39;options(max.print= *, width = *)&#39;
##  ..............................</code></pre>
<pre><code>##    [[ suppressing 10 column names &#39;ATGCCAGAACGACT&#39;, &#39;CATGGCCTGTGCAT&#39;, &#39;GAACCTGATGAACC&#39; ... ]]</code></pre>
<pre><code>##                              
## GNG11     . . . . . . . . . .
## CLU       . . . . . . . . . .
## HIST1H2AC . . . . . . . . . .
## NCOA4     . 1 . . . . . . 1 .
## GP9       . . . . . . . . . .
## FERMT3    . 1 . . . . . . . .
## ODC1      1 . . . . 1 . . . .
## CD9       . . . . . . . . . .
## RUFY1     . . . . . . . . . .
## TUBB1     . 1 . . . . . . . .
## TALDO1    1 2 . . 2 . . . . .
## TREML1    . . . . . . . . . .
## NGFRAP1   . . . . . 1 . . . .
## PGRMC1    . . . . . . . . . .
## CA2       . . . . . . . . . .
## ITGA2B    . . . . . . . . . .
## MYL9      . . . . . . . . . .
## TMEM40    . . . . . . . . . .
## PARVB     . . . . . . . . . .
## PTCRA     . . . . . . . . . .
## ACRBP     1 . . . . . . . . .
## TSC22D1   . . . . . . . . . .
## VDAC3     . . . 1 . . 1 . . 1
## GZMB      . . . . . . . . . .
## GZMA      . . . . . . 1 . . .
## GNLY      . . . 1 . . . . . .
## FGFBP2    . . . . . . . . . .
## AKR1C3    . . . . . . . . . .
## CCL4      . . . . . . . . . .
## PRF1      . 1 . . . . . . . .
## GZMH      . . . . . . . . . .
## XBP1      1 . 1 1 2 . . 1 . .
## GZMM      . 1 . . 1 1 . . . .
## PTGDR     . . . . . . . . . .
## IGFBP7    . . . . . . . . . .
## TTC38     . . . . . . . . . .
## KLRD1     . . . . . . . . . .
## ARHGDIA   . 1 . . . . . . . .
## IL2RB     . . . . . . . . . .
## CLIC3     . . . . . . . . . .
## PPP1R18   . 1 . . . 1 . . . 1
## CD247     . 1 1 . 2 1 . . . .
## ALOX5AP   1 . . . 1 . . 1 . .
## XCL2      . . . . . . . . . .
## C12orf75  . . . . . . . . . .
## RARRES3   1 . . 3 . 1 1 . 1 .
## PCMT1     . . . . . . . . . .
## LAMP1     1 . . . . . 1 . . .
## SPON2     . 1 . . . . . . . .
## S100B     . . . . . . . . . .</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb251-1"></a>pbmc_small<span class="op">@</span>assays<span class="op">$</span>RNA<span class="op">@</span>counts[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</span></code></pre></div>
<p>Some text to see if the output from above overlaps with the text below it.</p>

<p>In this lab, we will analyze a single cell RNA-seq dataset that will teach us about several methods to infer the differentiation trajectory of a set of cells. These methods can order a set of individual cells along a path / trajectory / lineage, and assign a pseudotime value to each cell that represents where the cell is along that path. This can be a starting point for further analysis to determine gene expression programs driving interesting cell phenotypes. As you are running the code, think about how the algorithms work and what you like and do not like about the assumptions and utilities provided by the algorithm.</p>
<p>Note: you can increase the system memory available to Docker by going to Docker -&gt; Preferences -&gt; Advanced and shifting the Memory slider.</p>
</div>
<div id="load-settings-and-packages-1" class="section level2">
<h2><span class="header-section-number">16.2</span> Load settings and packages</h2>
</div>
<div id="first-look-at-the-differentiation-data-from-deng-et-al." class="section level2">
<h2><span class="header-section-number">16.3</span> First look at the differentiation data from Deng et al.</h2>
<p>We will use a nice SMART-Seq2 single cell RNA-seq data from <a href="http://science.sciencemag.org/content/343/6167/193">Single-Cell RNA-Seq Reveals Dynamic, Random Monoallelic Gene Expression in Mammalian Cells</a>. Here is one relevant detail from their paper: “To investigate allele-specific gene expression at single-cell resolution, we isolated 269 individual cells dissociated from in vivo F1 embryos (CAST/EiJ × C57BL/6J, hereafter abbreviated as CAST and C57, respectively) from oocyte to blastocyst stages of mouse preimplantation development (PD)”</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb252-1"></a><span class="co"># Read in single cell data.</span></span>
<span id="cb252-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb252-2"></a>path.deng &lt;-<span class="st"> </span><span class="kw">paste0</span>(mydir, <span class="st">&quot;deng-reads.rds&quot;</span>)</span>
<span id="cb252-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb252-3"></a>deng_SCE &lt;-<span class="st"> </span><span class="kw">readRDS</span>(path.deng)</span>
<span id="cb252-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb252-4"></a></span>
<span id="cb252-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb252-5"></a><span class="co"># What class is the deng_SCE object, and how is it organized?</span></span>
<span id="cb252-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb252-6"></a><span class="kw">class</span>(deng_SCE)</span></code></pre></div>
<pre><code>## [1] &quot;SingleCellExperiment&quot;
## attr(,&quot;package&quot;)
## [1] &quot;SingleCellExperiment&quot;</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb254-1"></a><span class="kw">structure</span>(deng_SCE)</span></code></pre></div>
<pre><code>## class: SingleCellExperiment 
## dim: 22431 268 
## metadata(0):
## assays(2): counts logcounts
## rownames(22431): Hvcn1 Gbp7 ... Sox5 Alg11
## rowData names(10): feature_symbol is_feature_control ... total_counts
##   log10_total_counts
## colnames(268): 16cell 16cell.1 ... zy.2 zy.3
## colData names(30): cell_type2 cell_type1 ... pct_counts_ERCC
##   is_cell_control
## reducedDimNames(0):
## spikeNames(1): ERCC</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb256-1"></a><span class="co"># How many mouse cells are at each stage?</span></span>
<span id="cb256-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb256-2"></a><span class="kw">table</span>(deng_SCE<span class="op">$</span>cell_type1)</span></code></pre></div>
<pre><code>## 
## 16cell  2cell  4cell  8cell  blast zygote 
##     50     22     14     37    133     12</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb258-1"></a><span class="kw">table</span>(deng_SCE<span class="op">$</span>cell_type2)</span></code></pre></div>
<pre><code>## 
##     16cell      4cell      8cell early2cell earlyblast  late2cell  lateblast 
##         50         14         37          8         43         10         30 
##   mid2cell   midblast         zy 
##         12         60          4</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb260-1"></a><span class="co"># Re-order the levels of the factor storing the cell developmental stage.</span></span>
<span id="cb260-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb260-2"></a>deng_SCE<span class="op">$</span>cell_type2 &lt;-<span class="st"> </span><span class="kw">factor</span>(deng_SCE<span class="op">$</span>cell_type2,</span>
<span id="cb260-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb260-3"></a>                              <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;zy&quot;</span>, <span class="st">&quot;early2cell&quot;</span>, <span class="st">&quot;mid2cell&quot;</span>, <span class="st">&quot;late2cell&quot;</span>, </span>
<span id="cb260-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb260-4"></a>                                         <span class="st">&quot;4cell&quot;</span>, <span class="st">&quot;8cell&quot;</span>, <span class="st">&quot;16cell&quot;</span>, <span class="st">&quot;earlyblast&quot;</span>,</span>
<span id="cb260-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb260-5"></a>                                         <span class="st">&quot;midblast&quot;</span>, <span class="st">&quot;lateblast&quot;</span>))</span></code></pre></div>
</div>
<div id="principle-components-analysis" class="section level2">
<h2><span class="header-section-number">16.4</span> Principle Components Analysis</h2>
<p>Let us take a first look at the Deng data. One simple approach to ordering cells in pseudotime is to use PCA. By carrying out PCA and labeling the cells by the stage at which they were collected, we can see how well the principal components separate cells along a differentiation trajectory.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-1"></a><span class="co"># Run PCA on Deng data. Use the runPCA function from the SingleCellExperiment package.</span></span>
<span id="cb261-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-2"></a>deng_SCE &lt;-<span class="st"> </span><span class="kw">runPCA</span>(deng_SCE, <span class="dt">ncomponents =</span> <span class="dv">50</span>)</span>
<span id="cb261-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-3"></a></span>
<span id="cb261-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-4"></a><span class="co"># Use the reducedDim function to access the PCA and store the results. </span></span>
<span id="cb261-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-5"></a>pca &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(deng_SCE, <span class="st">&quot;PCA&quot;</span>)</span>
<span id="cb261-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-6"></a></span>
<span id="cb261-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-7"></a><span class="co"># Describe how the PCA is stored in a matrix. Why does it have this structure?</span></span>
<span id="cb261-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb261-8"></a><span class="kw">head</span>(pca)</span></code></pre></div>
<pre><code>##                PC1       PC2       PC3        PC4        PC5        PC6
## 16cell   -4.616718 -13.67367 1.6860222 -0.3971110  0.4331834 -3.3351871
## 16cell.1 -5.528782 -11.18717 2.9383081  0.2381910  0.1644197 -0.8666549
## 16cell.2 -5.067554 -13.50145 1.6200888 -1.4489428 -0.3560664 -2.7057527
## 16cell.3 -5.604999 -12.42408 1.2092483  0.7560287 -0.9812613  0.1008600
## 16cell.4 -4.989056 -12.64989 0.9518061  2.0114694  2.1210373 -0.5469395
## 16cell.5 -4.605128 -13.35725 1.2909256 -0.6736846  2.1882002 -2.7699870
##                 PC7        PC8        PC9      PC10      PC11       PC12
## 16cell   -0.6236209  0.3621665 -1.2910579  2.386634 -1.824875  0.4400858
## 16cell.1 -0.4232062 -1.0859542 -2.0577693  2.566871 -2.663335 -3.2087906
## 16cell.2  1.7515857  0.1552950 -1.5951345  1.879552 -3.237261 -0.9710867
## 16cell.3  1.0103357 -0.4448119 -0.6081911 -1.059523 -4.416895 -0.7229430
## 16cell.4  0.0563789 -0.7070924 -1.2665595  2.733815 -1.090173 -0.7688942
## 16cell.5  0.9010465  1.0445247 -2.8906108  2.886413 -1.844421 -4.2520016
##                 PC13        PC14       PC15       PC16       PC17         PC18
## 16cell   -0.77758746  2.11643418 -0.8244988  0.4831872 -0.8213527  2.912998472
## 16cell.1  1.95567784 -1.12330816 -2.0169080  2.0721840  0.4924598  1.555585976
## 16cell.2  1.77982275  0.02196743 -2.0566764  2.1791387 -1.8205026  1.544638100
## 16cell.3  1.82741705 -2.96140322 -2.0898322 -1.8926069 -1.2088311 -1.164002801
## 16cell.4  0.01732681 -0.77442110 -2.4652798  2.6683790 -1.0930128  0.492283751
## 16cell.5  1.26660076 -0.08437871 -1.9085246  0.8621796 -0.2821138 -0.004085098
##                PC19       PC20        PC21        PC22       PC23        PC24
## 16cell   -0.1114755  0.6633269 -0.88984647  2.73819461 -1.2833723  0.26093070
## 16cell.1 -1.1341038 -2.4003738 -1.00116216  2.79983998 -2.0626007 -1.49145200
## 16cell.2  0.2775379 -1.2832673 -0.46297320  0.08161412 -0.6273122 -0.82463839
## 16cell.3  0.8564781 -1.0032480 -0.02165817  2.81656780  1.1540990  1.64935692
## 16cell.4  0.1123406  0.6449514 -1.48016504  1.69637235  1.3036491 -0.04931057
## 16cell.5  0.9727746 -0.8545002 -0.82326712 -0.49085584 -2.4572424  0.28548367
##                PC25       PC26       PC27       PC28       PC29       PC30
## 16cell   -0.9025236 -0.9199517  0.7705592 -1.1942837  3.3616090 -0.8339894
## 16cell.1 -0.3073604 -1.6213086 -0.4668769  0.9442624 -1.3557627  1.5239438
## 16cell.2 -0.3514344 -0.9143962  0.1285442 -1.4033309  0.5669192 -0.5764371
## 16cell.3 -2.8926707  0.5279823  1.0364766  2.1822899  0.3327657 -3.9188841
## 16cell.4 -1.8065901 -2.3286922  0.7928030  1.5970783 -1.1079176 -0.6441109
## 16cell.5  0.9919387 -1.3399723 -0.4663864  2.7023565  1.1374510 -2.8720566
##                PC31          PC32       PC33       PC34        PC35       PC36
## 16cell   -2.6264466  0.2088315099  1.1394308  0.3840000 -0.30028319  0.5470062
## 16cell.1 -0.3786813 -2.0367506324  0.4802093 -1.5461206  0.57785418  0.2136878
## 16cell.2  0.2240873  0.2092731123 -0.6020883  0.2587835 -1.39670584  1.0217782
## 16cell.3 -0.2036249 -1.1033810361 -2.0222558 -1.5459463  0.98029013  1.6982863
## 16cell.4 -2.8524393  0.0004546378 -0.8323239  0.7580553 -0.08445444 -0.3581607
## 16cell.5 -1.0064513  1.8063507928 -0.2765822  1.4528263 -0.01488841 -2.0533203
##                PC37        PC38       PC39       PC40       PC41        PC42
## 16cell   -2.2521121  1.54130056 -0.5503021  1.8218871 -1.2491319  0.02774323
## 16cell.1 -3.1427911 -0.06859658  1.0455128  3.3915829  0.8911611  1.76258371
## 16cell.2 -0.9796248 -0.93454517 -1.4591025  0.1484064  0.7292182  0.89423648
## 16cell.3 -2.3282394 -0.95838032  0.1684409  0.6182237  0.8339745 -0.21181011
## 16cell.4  1.2995240  1.57202989  0.8189163 -2.3331272 -0.3108283 -0.31856432
## 16cell.5  0.9582204  1.45162192  2.1979823  1.0272293 -3.8152357  0.07293698
##                PC43       PC44      PC45       PC46       PC47       PC48
## 16cell   -1.2648452  1.3478074 -1.489203  1.6186833 -0.3300131  0.8603107
## 16cell.1  1.2310412 -0.3182549 -1.857164 -2.9553566 -2.2298687  0.4699274
## 16cell.2  0.6198856  1.9024444  0.096746  1.0150184  1.5574517 -0.3872533
## 16cell.3 -1.1234170  1.0566629 -1.311480 -0.4328987  2.7491211 -0.6665591
## 16cell.4  0.5818659 -1.2131792  1.086794  0.3857532  2.3153699  1.2776942
## 16cell.5 -0.8961840 -0.1003433  1.667234  1.5554497 -0.9303923 -0.8338826
##                PC49        PC50
## 16cell   -1.1294170  0.54900311
## 16cell.1 -0.9080707 -1.77789141
## 16cell.2  1.4262577 -0.08018494
## 16cell.3 -0.4120873  2.00067268
## 16cell.4 -0.9602715 -0.02929732
## 16cell.5  1.2653639  1.63364381</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb263-1"></a><span class="kw">dim</span>(pca)</span></code></pre></div>
<pre><code>## [1] 268  50</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-1"></a><span class="co"># Add PCA data to the deng_SCE object.</span></span>
<span id="cb265-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-2"></a>deng_SCE<span class="op">$</span>PC1 &lt;-<span class="st"> </span>pca[, <span class="dv">1</span>]</span>
<span id="cb265-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-3"></a>deng_SCE<span class="op">$</span>PC2 &lt;-<span class="st"> </span>pca[, <span class="dv">2</span>]</span>
<span id="cb265-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-4"></a></span>
<span id="cb265-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-5"></a><span class="co"># Plot PC biplot with cells colored by cell_type2. </span></span>
<span id="cb265-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-6"></a><span class="co"># colData(deng_SCE) accesses the cell metadata DataFrame object for deng_SCE.</span></span>
<span id="cb265-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-7"></a><span class="co"># Look at Figure 1A of the paper as a comparison to your PC biplot.</span></span>
<span id="cb265-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-8"></a><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2, <span class="dt">color =</span> cell_type2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb265-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-9"></a><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb265-10"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb265-10"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;PC1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;PC2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;PC biplot&quot;</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/pca_pseudotime-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-1"></a><span class="co"># PCA is a simple approach and can be good to compare to more complex algorithms </span></span>
<span id="cb266-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-2"></a><span class="co"># designed to capture differentiation processes. As a simple measure of pseudotime </span></span>
<span id="cb266-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-3"></a><span class="co"># we can use the coordinates of PC1.</span></span>
<span id="cb266-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-4"></a><span class="co"># Plot PC1 vs cell_type2. </span></span>
<span id="cb266-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-5"></a>deng_SCE<span class="op">$</span>pseudotime_PC1 &lt;-<span class="st"> </span><span class="kw">rank</span>(deng_SCE<span class="op">$</span>PC1)  <span class="co"># rank cells by their PC1 score</span></span>
<span id="cb266-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-6"></a><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_PC1, <span class="dt">y =</span> cell_type2, </span>
<span id="cb266-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-7"></a>                                             <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></span>
<span id="cb266-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-8"></a><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb266-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-9"></a><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb266-10"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-10"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;PC1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></span>
<span id="cb266-11"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb266-11"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by first principal component&quot;</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/pca_pseudotime-2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb267-1"></a><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_PC1.png&quot;</span>))</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb269-1"></a><span class="co"># Try separating the cell types using other PCs. How does the separation look?</span></span></code></pre></div>
</div>
<div id="diffusion-map-pseudotime" class="section level2">
<h2><span class="header-section-number">16.5</span> Diffusion map pseudotime</h2>
<p>Let us see how a more advance trajectory inference method, diffusion maps and diffusion pseudotime, performs at placing cells along the expected differentiation trajectory.</p>
<p><a href="https://en.wikipedia.org/wiki/Diffusion_map">Diffusion maps</a> were introduced by <a href="http://www.sciencedirect.com/science/article/pii/S1063520306000546">Ronald Coifman and Stephane Lafon</a>, and the underlying idea is to assume that the data are samples from a diffusion process. The method infers the low-dimensional manifold by estimating the eigenvalues and eigenvectors for the diffusion operator related to the data.</p>
<p><a href="https://academic.oup.com/bioinformatics/article/32/8/1241/1744143">Angerer et al</a> have applied the diffusion maps concept to the analysis of single-cell RNA-seq data to create an R package called <a href="http://bioconductor.org/packages/destiny">destiny</a>.</p>
<p>We will use two forms of pseudotime: the first diffusion component and the diffusion pseudotime.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-1"></a><span class="co">#  Prepare a counts matrix with labeled rows and columns. </span></span>
<span id="cb270-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-2"></a>deng &lt;-<span class="st"> </span><span class="kw">logcounts</span>(deng_SCE)  <span class="co"># access log-transformed counts matrix</span></span>
<span id="cb270-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-3"></a>cellLabels &lt;-<span class="st"> </span>deng_SCE<span class="op">$</span>cell_type2</span>
<span id="cb270-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-4"></a><span class="kw">colnames</span>(deng) &lt;-<span class="st"> </span>cellLabels</span>
<span id="cb270-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-5"></a></span>
<span id="cb270-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-6"></a><span class="co"># Make a diffusion map.</span></span>
<span id="cb270-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-7"></a>dm &lt;-<span class="st"> </span><span class="kw">DiffusionMap</span>(<span class="kw">t</span>(deng))</span>
<span id="cb270-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-8"></a></span>
<span id="cb270-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-9"></a><span class="co"># Optional: Try different sigma values when making diffusion map.</span></span>
<span id="cb270-10"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-10"></a><span class="co"># dm &lt;- DiffusionMap(t(deng), sigma = &quot;local&quot;)  # use local option to set sigma</span></span>
<span id="cb270-11"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-11"></a><span class="co"># sigmas &lt;- find_sigmas(t(deng), verbose = FALSE)  # find optimal sigma</span></span>
<span id="cb270-12"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-12"></a><span class="co"># dm &lt;- DiffusionMap(t(deng), sigma = optimal_sigma(sigmas))  </span></span>
<span id="cb270-13"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-13"></a></span>
<span id="cb270-14"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-14"></a><span class="co"># Plot diffusion component 1 vs diffusion component 2 (DC1 vs DC2). </span></span>
<span id="cb270-15"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-15"></a>tmp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">DC1 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">1</span>],</span>
<span id="cb270-16"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-16"></a>                  <span class="dt">DC2 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">2</span>],</span>
<span id="cb270-17"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-17"></a>                  <span class="dt">Timepoint =</span> deng_SCE<span class="op">$</span>cell_type2)</span>
<span id="cb270-18"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-18"></a><span class="kw">ggplot</span>(tmp, <span class="kw">aes</span>(<span class="dt">x =</span> DC1, <span class="dt">y =</span> DC2, <span class="dt">colour =</span> Timepoint)) <span class="op">+</span></span>
<span id="cb270-19"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-19"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb270-20"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-20"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion component 1&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb270-21"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-21"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Diffusion component 2&quot;</span>) <span class="op">+</span></span>
<span id="cb270-22"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb270-22"></a><span class="st">    </span><span class="kw">theme_classic</span>()</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/diffusion_pseudotime-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-1"></a><span class="co"># Try plotting higher diffusion components against one another.</span></span>
<span id="cb271-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-2"></a></span>
<span id="cb271-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-3"></a><span class="co"># Next, let us use the first diffusion component (DC1) as a measure of pseudotime.</span></span>
<span id="cb271-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-4"></a><span class="co"># How does the separation by cell stage look?</span></span>
<span id="cb271-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-5"></a>deng_SCE<span class="op">$</span>pseudotime_diffusionmap &lt;-<span class="st"> </span><span class="kw">rank</span>(<span class="kw">eigenvectors</span>(dm)[,<span class="dv">1</span>])    <span class="co"># rank cells by their dpt</span></span>
<span id="cb271-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-6"></a><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </span>
<span id="cb271-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-7"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_diffusionmap, </span>
<span id="cb271-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-8"></a>           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></span>
<span id="cb271-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-9"></a><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb271-10"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-10"></a><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb271-11"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-11"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion component 1 (DC1)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></span>
<span id="cb271-12"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb271-12"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by DC1&quot;</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/diffusion_pseudotime-2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb272-1"></a><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_DC1.png&quot;</span>))</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb274-1"></a><span class="co"># Plot eigenvalues of diffusion distance matrix. How many diffusion components would you use?</span></span>
<span id="cb274-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb274-2"></a><span class="co"># This is analagous to the PC elbow plot (scree plot) that we previously used to assess how </span></span>
<span id="cb274-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb274-3"></a><span class="co"># many PCs to use in downstream applications like clustering.</span></span>
<span id="cb274-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb274-4"></a><span class="kw">plot</span>(<span class="kw">eigenvalues</span>(dm), <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> <span class="st">&#39;Diffusion component (DC)&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Eigenvalue&#39;</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/diffusion_pseudotime-3.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-1"></a><span class="co"># What happens if you run the diffusion map on the PCs? Why would one do this?</span></span>
<span id="cb275-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-2"></a><span class="kw">rownames</span>(pca) &lt;-<span class="st"> </span>cellLabels</span>
<span id="cb275-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-3"></a>dm &lt;-<span class="st"> </span><span class="kw">DiffusionMap</span>(pca)</span>
<span id="cb275-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-4"></a></span>
<span id="cb275-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-5"></a><span class="co"># Diffusion pseudotime calculation. </span></span>
<span id="cb275-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-6"></a><span class="co"># Set index or tip of pseudotime calculation to be a zygotic cell (cell 268). </span></span>
<span id="cb275-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-7"></a>dpt &lt;-<span class="st"> </span><span class="kw">DPT</span>(dm, <span class="dt">tips =</span> <span class="dv">268</span>)</span>
<span id="cb275-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-8"></a></span>
<span id="cb275-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-9"></a><span class="co"># Plot DC1 vs DC2 and color the cells by their inferred diffusion pseudotime.</span></span>
<span id="cb275-10"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-10"></a><span class="co"># We can accesss diffusion pseudotime via dpt$dpt.</span></span>
<span id="cb275-11"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-11"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">DC1 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">1</span>], <span class="dt">DC2 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">2</span>], </span>
<span id="cb275-12"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-12"></a>                 <span class="dt">dptval =</span> dpt<span class="op">$</span>dpt, <span class="dt">cell_type2 =</span> deng_SCE<span class="op">$</span>cell_type2)</span>
<span id="cb275-13"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-13"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DC1, <span class="dt">y =</span> DC2, <span class="dt">color =</span> dptval))</span>
<span id="cb275-14"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-14"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DC1, <span class="dt">y =</span> DC2, <span class="dt">color =</span> cell_type2))</span>
<span id="cb275-15"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-15"></a>p &lt;-<span class="st"> </span><span class="kw">plot_grid</span>(p1, p2)</span>
<span id="cb275-16"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb275-16"></a>p</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/diffusion_pseudotime-4.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-1"></a><span class="kw">save_plot</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/dpt_celltype.png&quot;</span>), p, <span class="dt">base_height =</span> <span class="dv">5</span>, <span class="dt">base_aspect_ratio =</span> <span class="dv">2</span>)</span>
<span id="cb276-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-2"></a></span>
<span id="cb276-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-3"></a><span class="co"># Plot diffusion pseudotime vs timepoint. </span></span>
<span id="cb276-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-4"></a><span class="co"># Which separates the data better, DC1 or diffusion pseudotime?</span></span>
<span id="cb276-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-5"></a>deng_SCE<span class="op">$</span>pseudotime_dpt &lt;-<span class="st"> </span><span class="kw">rank</span>(dpt<span class="op">$</span>dpt) </span>
<span id="cb276-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-6"></a><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </span>
<span id="cb276-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-7"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_dpt, </span>
<span id="cb276-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-8"></a>           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></span>
<span id="cb276-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-9"></a><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb276-10"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-10"></a><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb276-11"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-11"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion map pseudotime (dpt)&quot;</span>) <span class="op">+</span></span>
<span id="cb276-12"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-12"></a><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></span>
<span id="cb276-13"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb276-13"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by diffusion map pseudotime&quot;</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/diffusion_pseudotime-5.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb277-1"></a><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_dpt.png&quot;</span>))</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb279-1"></a><span class="co"># Save current progress.</span></span>
<span id="cb279-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb279-2"></a><span class="kw">save</span>(deng_SCE, <span class="dt">file =</span> Rda.destiny.path)</span>
<span id="cb279-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb279-3"></a><span class="co"># To load the data, run the following command.</span></span>
<span id="cb279-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb279-4"></a><span class="co"># load(Rda.destiny.path)</span></span></code></pre></div>
</div>
<div id="slingshot-map-pseudotime" class="section level2">
<h2><span class="header-section-number">16.6</span> Slingshot map pseudotime</h2>
<p>Let us see how another advance trajectory inference method, Slingshot, performs at placing cells along the expected differentiation trajectory.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb280-1"></a><span class="kw">library</span>(slingshot)</span></code></pre></div>
<pre><code>## Warning: package &#39;slingshot&#39; was built under R version 3.5.1</code></pre>
<pre><code>## Loading required package: princurve</code></pre>
<pre><code>## Warning: package &#39;princurve&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: replacing previous import &#39;SingleCellExperiment::weights&#39; by
## &#39;stats::weights&#39; when loading &#39;slingshot&#39;</code></pre>
<pre><code>## Warning: namespace &#39;bigmemory&#39; is not available and has been replaced
## by .GlobalEnv when processing object &#39;&#39;

## Warning: namespace &#39;bigmemory&#39; is not available and has been replaced
## by .GlobalEnv when processing object &#39;&#39;</code></pre>
<pre><code>## Warning: namespace &#39;copula&#39; is not available and has been replaced
## by .GlobalEnv when processing object &#39;&#39;

## Warning: namespace &#39;copula&#39; is not available and has been replaced
## by .GlobalEnv when processing object &#39;&#39;

## Warning: namespace &#39;copula&#39; is not available and has been replaced
## by .GlobalEnv when processing object &#39;&#39;

## Warning: namespace &#39;copula&#39; is not available and has been replaced
## by .GlobalEnv when processing object &#39;&#39;

## Warning: namespace &#39;copula&#39; is not available and has been replaced
## by .GlobalEnv when processing object &#39;&#39;</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-1"></a><span class="kw">library</span>(Seurat)</span>
<span id="cb287-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-2"></a></span>
<span id="cb287-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-3"></a><span class="co"># load(Rda.destiny.path)</span></span>
<span id="cb287-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-4"></a></span>
<span id="cb287-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-5"></a><span class="co"># Read the Slingshot documentation (?slingshot) and then run Slingshot below. </span></span>
<span id="cb287-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-6"></a><span class="co"># Given your understanding of the algorithm and the documentation, what is one </span></span>
<span id="cb287-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-7"></a><span class="co"># major set of parameters we omitted here when running Slingshot?</span></span>
<span id="cb287-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb287-8"></a>sce &lt;-<span class="st"> </span><span class="kw">slingshot</span>(deng_SCE, <span class="dt">reducedDim =</span> <span class="st">&#39;PCA&#39;</span>)  <span class="co"># no clusters</span></span></code></pre></div>
<pre><code>## No cluster labels provided. Continuing with one cluster.</code></pre>
<pre><code>## Using full covariance matrix</code></pre>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb290-1"></a><span class="co"># Plot PC1 vs PC2 colored by Slingshot pseudotime.</span></span>
<span id="cb290-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb290-2"></a>colors &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="dv">50</span>, <span class="dt">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb290-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb290-3"></a><span class="kw">plot</span>(<span class="kw">reducedDims</span>(sce)<span class="op">$</span>PCA, <span class="dt">col =</span> colors[<span class="kw">cut</span>(sce<span class="op">$</span>slingPseudotime_<span class="dv">1</span>,<span class="dt">breaks=</span><span class="dv">50</span>)], <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">asp =</span> <span class="dv">1</span>)</span>
<span id="cb290-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb290-4"></a><span class="kw">lines</span>(<span class="kw">SlingshotDataSet</span>(sce), <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/slingshot-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb291-1"></a><span class="co"># Plot Slingshot pseudotime vs cell stage. </span></span>
<span id="cb291-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb291-2"></a><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> sce<span class="op">$</span>slingPseudotime_<span class="dv">1</span>, <span class="dt">y =</span> cell_type2, </span>
<span id="cb291-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb291-3"></a>                              <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></span>
<span id="cb291-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb291-4"></a><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb291-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb291-5"></a><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb291-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb291-6"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Slingshot pseudotime&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></span>
<span id="cb291-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb291-7"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by Slingshot pseudotime&quot;</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/slingshot-2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb292-1"></a><span class="co"># Cluster cells using the Seurat workflow below.</span></span>
<span id="cb292-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb292-2"></a>gcdata &lt;-<span class="st"> </span><span class="kw">CreateSeuratObject</span>(<span class="dt">counts =</span> <span class="kw">counts</span>(deng_SCE), <span class="dt">project =</span> <span class="st">&quot;slingshot&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Feature names cannot have pipe characters (&#39;|&#39;), replacing with dashes
## (&#39;-&#39;)</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb294-1"></a>gcdata &lt;-<span class="st"> </span><span class="kw">NormalizeData</span>(gcdata, <span class="dt">normalization.method =</span> <span class="st">&quot;LogNormalize&quot;</span>, <span class="dt">scale.factor =</span> <span class="dv">10000</span>)</span>
<span id="cb294-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb294-2"></a>gcdata &lt;-<span class="st"> </span><span class="kw">FindVariableFeatures</span>(gcdata, <span class="dt">selection.method =</span> <span class="st">&quot;vst&quot;</span>, <span class="dt">nfeatures =</span> <span class="dv">2000</span>)</span>
<span id="cb294-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb294-3"></a>gcdata &lt;-<span class="st"> </span><span class="kw">ScaleData</span>(<span class="dt">object =</span> gcdata, <span class="dt">do.center =</span> T, <span class="dt">do.scale =</span> F)</span></code></pre></div>
<pre><code>## Centering data matrix</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb296-1"></a>gcdata &lt;-<span class="st"> </span><span class="kw">RunPCA</span>(gcdata, <span class="dt">features =</span> <span class="kw">VariableFeatures</span>(gcdata), <span class="dt">npcs =</span> <span class="dv">40</span>, <span class="dt">ndims.print =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">nfeatures.print =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## PC_ 1 
## Positive:  Actb, Fabp3, Psap, Akr1b8, Krt18 
## Negative:  Zbed3, C86187, Klf17, Btg4, Ccdc6 
## PC_ 2 
## Positive:  Krt18, Id2, Akr1b8, BC053393, Fabp3 
## Negative:  Gm11517, Alppl2, Obox6, Pdxk, Trim43b 
## PC_ 3 
## Positive:  Id2, Krt18, Tspan8, BC053393, Krt8 
## Negative:  Gm11517, Alppl2, Ypel5, Pdxk, Fam46c 
## PC_ 4 
## Positive:  Alppl2, Dab2, Gm11517, Krt18, Tspan8 
## Negative:  Upp1, Tdgf1, Spp1, Zfp57, Tat 
## PC_ 5 
## Positive:  Klf17, Ddx24, Bod1l, Tor1b, Gm1995 
## Negative:  Alppl2, Gm4340, Gm11756, Gm8300, Gm5039</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb298-1"></a><span class="co"># Cluster the cells using the first twenty principal components.</span></span>
<span id="cb298-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb298-2"></a>gcdata &lt;-<span class="st"> </span><span class="kw">FindNeighbors</span>(gcdata, <span class="dt">reduction =</span> <span class="st">&quot;pca&quot;</span>, <span class="dt">dims =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">k.param =</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>## Computing nearest neighbor graph</code></pre>
<pre><code>## Computing SNN</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb301-1"></a>gcdata &lt;-<span class="st"> </span><span class="kw">FindClusters</span>(gcdata, <span class="dt">resolution =</span> <span class="fl">0.6</span>, <span class="dt">algorithm =</span> <span class="dv">4</span>, <span class="dt">random.seed =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## 218 singletons identified. 14 final clusters.</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb303-1"></a><span class="co"># Add clustering information from Seurat to the deng_SCE object</span></span>
<span id="cb303-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb303-2"></a>deng_SCE<span class="op">$</span>slingPseudotime_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>  <span class="co"># remove old slingshot pseudotime data</span></span>
<span id="cb303-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb303-3"></a><span class="kw">colData</span>(deng_SCE)<span class="op">$</span>Seurat_clusters &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">Idents</span>(gcdata))  <span class="co"># go from factor to character</span></span>
<span id="cb303-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb303-4"></a></span>
<span id="cb303-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb303-5"></a><span class="co"># Then run Slingshot using these cluster assignments.</span></span>
<span id="cb303-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb303-6"></a>deng_SCE &lt;-<span class="st"> </span><span class="kw">slingshot</span>(deng_SCE, <span class="dt">clusterLabels =</span> <span class="st">&#39;Seurat_clusters&#39;</span>, <span class="dt">reducedDim =</span> <span class="st">&#39;PCA&#39;</span>)</span></code></pre></div>
<pre><code>## Using diagonal covariance matrix</code></pre>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb305-1"></a><span class="co"># Plot PC1 vs PC2 colored by Slingshot pseudotime.</span></span>
<span id="cb305-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb305-2"></a>colors &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="dv">50</span>, <span class="dt">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb305-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb305-3"></a><span class="kw">plot</span>(<span class="kw">reducedDims</span>(deng_SCE)<span class="op">$</span>PCA, <span class="dt">col =</span> colors[<span class="kw">cut</span>(deng_SCE<span class="op">$</span>slingPseudotime_<span class="dv">1</span>,<span class="dt">breaks=</span><span class="dv">50</span>)], <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">asp =</span> <span class="dv">1</span>)</span>
<span id="cb305-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb305-4"></a><span class="kw">lines</span>(<span class="kw">SlingshotDataSet</span>(deng_SCE), <span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/slingshot-3.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb306-1"></a><span class="co"># Plot Slingshot pseudotime vs cell stage. </span></span>
<span id="cb306-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb306-2"></a><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> slingPseudotime_<span class="dv">1</span>, <span class="dt">y =</span> cell_type2, </span>
<span id="cb306-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb306-3"></a>                              <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></span>
<span id="cb306-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb306-4"></a><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb306-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb306-5"></a><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></span>
<span id="cb306-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb306-6"></a><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Slingshot pseudotime&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></span>
<span id="cb306-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb306-7"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by Slingshot pseudotime&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 98 rows containing missing values (position_quasirandom).</code></pre>
<p><img src="2020_scWorkshop_files/figure-html/slingshot-4.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb308-1"></a><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_slingshot.png&quot;</span>))</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre><code>## Warning: Removed 98 rows containing missing values (position_quasirandom).</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb311-1"></a><span class="co"># Save current progress.</span></span>
<span id="cb311-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb311-2"></a><span class="kw">save</span>(deng_SCE, <span class="dt">file =</span> Rda.slingshot.path)</span>
<span id="cb311-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb311-3"></a><span class="co"># To load the data, run the following command.</span></span>
<span id="cb311-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb311-4"></a><span class="co"># load(Rda.slingshot.path)</span></span></code></pre></div>
</div>
<div id="find-temporally-expressed-genes" class="section level2">
<h2><span class="header-section-number">16.7</span> Find temporally expressed genes</h2>
<p>In this final analysis code chunk, we will identify temporally expressed genes, ie those genes whose expression is changing in a continuous manner over pseudotime. To do this, we will fit a GAM with a LOESS term for pseudotime. Functions for fitting and working with generalized additive models, as described in “Generalized Additive Models” (Hastie and Tibshirani, 1990).
<a href="https://multithreaded.stitchfix.com/blog/2015/07/30/gam/">Read more about GAMs</a></p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-1"></a><span class="co"># Only look at the 1,000 most variable genes when identifying temporally expressesd genes.</span></span>
<span id="cb312-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-2"></a><span class="co"># Identify the variable genes by ranking all genes by their variance.</span></span>
<span id="cb312-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-3"></a>Y &lt;-<span class="st"> </span><span class="kw">log2</span>(<span class="kw">counts</span>(deng_SCE) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb312-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-4"></a>var1K &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">sort</span>(<span class="kw">apply</span>(Y, <span class="dv">1</span>, var), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>]</span>
<span id="cb312-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-5"></a>Y &lt;-<span class="st"> </span>Y[var1K, ]  <span class="co"># only counts for variable genes</span></span>
<span id="cb312-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-6"></a></span>
<span id="cb312-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-7"></a><span class="co"># Fit GAM for each gene using pseudotime as independent variable.</span></span>
<span id="cb312-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-8"></a>t &lt;-<span class="st"> </span>deng_SCE<span class="op">$</span>slingPseudotime_<span class="dv">1</span></span>
<span id="cb312-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-9"></a>gam.pval &lt;-<span class="st"> </span><span class="kw">apply</span>(Y, <span class="dv">1</span>, <span class="cf">function</span>(z){</span>
<span id="cb312-10"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-10"></a>  d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z=</span>z, <span class="dt">t=</span>t)</span>
<span id="cb312-11"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-11"></a>  tmp &lt;-<span class="st"> </span><span class="kw">gam</span>(z <span class="op">~</span><span class="st"> </span><span class="kw">lo</span>(t), <span class="dt">data=</span>d)</span>
<span id="cb312-12"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-12"></a>  p &lt;-<span class="st"> </span><span class="kw">summary</span>(tmp)[<span class="dv">4</span>][[<span class="dv">1</span>]][<span class="dv">1</span>,<span class="dv">5</span>]</span>
<span id="cb312-13"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-13"></a>  p</span>
<span id="cb312-14"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-14"></a>})</span>
<span id="cb312-15"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-15"></a></span>
<span id="cb312-16"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-16"></a><span class="co"># Identify genes with the most significant time-dependent model fit.</span></span>
<span id="cb312-17"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-17"></a>topgenes &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">sort</span>(gam.pval, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>]  </span>
<span id="cb312-18"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-18"></a></span>
<span id="cb312-19"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-19"></a><span class="co"># Prepare and plot a heatmap of the top genes that vary their expression over pseudotime.</span></span>
<span id="cb312-20"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-20"></a><span class="kw">require</span>(clusterExperiment)</span>
<span id="cb312-21"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-21"></a>heatdata &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(gcdata[[<span class="st">&#39;RNA&#39;</span>]]<span class="op">@</span>data[<span class="kw">rownames</span>(gcdata) <span class="op">%in%</span><span class="st"> </span>topgenes, <span class="kw">order</span>(t, <span class="dt">na.last =</span> <span class="ot">NA</span>)])</span>
<span id="cb312-22"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-22"></a>heatclus &lt;-<span class="st"> </span><span class="kw">Idents</span>(gcdata)[<span class="kw">order</span>(t, <span class="dt">na.last =</span> <span class="ot">NA</span>)]</span>
<span id="cb312-23"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-23"></a><span class="kw">png</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;heatmap_time_genes.png&quot;</span>), <span class="dt">width=</span><span class="dv">10</span>, <span class="dt">height=</span><span class="dv">10</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">res=</span><span class="dv">200</span>)</span>
<span id="cb312-24"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-24"></a><span class="co"># ce &lt;- ClusterExperiment(heatdata, heatclus, transformation = log1p)</span></span>
<span id="cb312-25"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-25"></a><span class="co"># clusterExperiment::plotHeatmap(ce, clusterSamplesData = &quot;orderSamplesValue&quot;, visualizeData = &#39;transformed&#39;, cexRow = 1.5, fontsize = 15)</span></span>
<span id="cb312-26"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-26"></a><span class="kw">heatmap</span>(<span class="kw">log1p</span>(heatdata), <span class="dt">Colv =</span> <span class="ot">NA</span>, <span class="dt">ColSideColors =</span> <span class="kw">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;Set1&quot;</span>)[heatclus])</span>
<span id="cb312-27"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb312-27"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
</div>
<div id="comparison-of-the-different-trajectory-inference-methods" class="section level2">
<h2><span class="header-section-number">16.8</span> Comparison of the different trajectory inference methods</h2>
<p>How do the trajectories inferred by PCA, diffusion pseudotime, and slingshot pseudotime compare to one another?</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-1"></a><span class="co"># Prepare data frame with different pseudotime measures.</span></span>
<span id="cb314-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-2"></a>df_pseudotime &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)[, <span class="kw">c</span>(<span class="st">&quot;pseudotime_PC1&quot;</span>, <span class="st">&quot;pseudotime_dpt&quot;</span>, <span class="st">&quot;slingPseudotime_1&quot;</span>)])</span>
<span id="cb314-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-3"></a><span class="kw">colnames</span>(df_pseudotime) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;diffusion&quot;</span>, <span class="st">&quot;slingshot&quot;</span>)</span>
<span id="cb314-4"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-4"></a></span>
<span id="cb314-5"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-5"></a><span class="co"># Plot correlation between different pseudotime measures.</span></span>
<span id="cb314-6"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-6"></a><span class="kw">corrplot.mixed</span>(<span class="kw">cor</span>(df_pseudotime, <span class="dt">use =</span> <span class="st">&quot;na.or.complete&quot;</span>), </span>
<span id="cb314-7"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-7"></a>               <span class="dt">order =</span> <span class="st">&quot;hclust&quot;</span>, <span class="dt">tl.col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb314-8"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-8"></a>               <span class="dt">main =</span> <span class="st">&quot;Correlation matrix for pseudotime results&quot;</span>,</span>
<span id="cb314-9"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb314-9"></a>               <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">3.1</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="2020_scWorkshop_files/figure-html/compare-1.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="plots-of-gene-expression-over-time." class="section level2">
<h2><span class="header-section-number">16.9</span> Plots of gene expression over time.</h2>
<p>Visualize how some of the temporally expressed genes change in time.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb315-1"></a><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Obox5&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>, </span>
<span id="cb315-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb315-2"></a>               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</span>
<span id="cb315-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb315-3"></a>               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="2020_scWorkshop_files/figure-html/visualize-1.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb317-1"></a><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Obox5&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;pseudotime_dpt&quot;</span>, </span>
<span id="cb317-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb317-2"></a>               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</span>
<span id="cb317-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb317-3"></a>               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="2020_scWorkshop_files/figure-html/visualize-2.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb319-1"></a><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Obox5&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;slingPseudotime_1&quot;</span>, </span>
<span id="cb319-2"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb319-2"></a>               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</span>
<span id="cb319-3"><a href="advanced-topics-pseudotime-cell-trajectories.html#cb319-3"></a>               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 98 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 98 rows containing missing values (geom_point).</code></pre>
<p><img src="2020_scWorkshop_files/figure-html/visualize-3.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="acknowledgements-1" class="section level2">
<h2><span class="header-section-number">16.10</span> Acknowledgements</h2>
<p>This document builds off chapter 8.4 from the <a href="https://scrnaseq-course.cog.sanger.ac.uk/website/biological-analysis.html">Analysis of single cell RNA-seq data</a>, from the <a href="https://bioconductor.org/packages/release/bioc/html/destiny.html">Destiny vignette</a> and from the <a href="https://www.bioconductor.org/packages/devel/bioc/vignettes/slingshot/inst/doc/slingshot.html">Slingshot vignette</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="acknowledgements.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="single-cell-resources.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["2020_scWorkshop.pdf", "2020_scWorkshop.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
