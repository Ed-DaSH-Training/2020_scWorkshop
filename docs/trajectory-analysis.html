<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 Trajectory Analysis | ANALYSIS OF SINGLE CELL RNA-SEQ DATA</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="14 Trajectory Analysis | ANALYSIS OF SINGLE CELL RNA-SEQ DATA" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://broadinstitute.github.io/2020_scWorkshop/" />
  <meta property="og:image" content="https://broadinstitute.github.io/2020_scWorkshop/images/cover.png" />
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="broadinstitute/2019_scWorkship" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Trajectory Analysis | ANALYSIS OF SINGLE CELL RNA-SEQ DATA" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="twitter:image" content="https://broadinstitute.github.io/2020_scWorkshop/images/cover.png" />

<meta name="author" content="Orr Ashenberg" />
<meta name="author" content="Dana Silverbush" />
<meta name="author" content="Kirk Gosik" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="trajectory-inference.html"/>
<link rel="next" href="mutli-omic-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ANALYSIS OF SINGLE CELL RNA-SEQ DATA</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-overview"><i class="fa fa-check"></i><b>1.1</b> COURSE OVERVIEW</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#targeted-audience-assumed-background"><i class="fa fa-check"></i><b>1.2</b> TARGETED AUDIENCE &amp; ASSUMED BACKGROUND</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#course-format"><i class="fa fa-check"></i><b>1.3</b> COURSE FORMAT</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#getting-started"><i class="fa fa-check"></i><b>1.4</b> Getting Started</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#session-content"><i class="fa fa-check"></i><b>1.5</b> SESSION CONTENT</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#monday-classes-from-0800-to-1600-lunch-break-1-hr-40-min-of-total-coffee-breaks"><i class="fa fa-check"></i><b>1.5.1</b> Monday – Classes from 08:00 to 16:00 (lunch break-1 hr, 40 min of total coffee breaks)</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#tuesday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.2</b> Tuesday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#wednesday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.3</b> Wednesday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.4" data-path="index.html"><a href="index.html#thursday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.4</b> Thursday – Classes from 08:00 to 16:00</a></li>
<li class="chapter" data-level="1.5.5" data-path="index.html"><a href="index.html#friday-classes-from-0800-to-1600"><i class="fa fa-check"></i><b>1.5.5</b> Friday – Classes from 08:00 to 16:00</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-1.html"><a href="introduction-1.html#slides"><i class="fa fa-check"></i><b>2.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html"><i class="fa fa-check"></i><b>3</b> Understanding Sequencing Raw Data</a><ul>
<li class="chapter" data-level="3.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#class-environment"><i class="fa fa-check"></i><b>3.1</b> Class Environment</a><ul>
<li class="chapter" data-level="3.1.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#getting-into-aws-instance"><i class="fa fa-check"></i><b>3.1.1</b> Getting into AWS Instance</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#shell-and-unix-commands"><i class="fa fa-check"></i><b>3.2</b> Shell and Unix commands</a><ul>
<li class="chapter" data-level="3.2.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#common-linux-commands"><i class="fa fa-check"></i><b>3.2.1</b> Common Linux Commands</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#file-formats"><i class="fa fa-check"></i><b>3.3</b> File formats</a><ul>
<li class="chapter" data-level="3.3.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#view-fastq-files"><i class="fa fa-check"></i><b>3.3.1</b> View FASTQ Files</a></li>
<li class="chapter" data-level="3.3.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#view-bam-files"><i class="fa fa-check"></i><b>3.3.2</b> View BAM Files</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#public-data-repositories"><i class="fa fa-check"></i><b>3.4</b> Public data repositories</a><ul>
<li class="chapter" data-level="3.4.1" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#cellranger10x"><i class="fa fa-check"></i><b>3.4.1</b> Cellranger/10x</a></li>
<li class="chapter" data-level="3.4.2" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#geo"><i class="fa fa-check"></i><b>3.4.2</b> GEO</a></li>
<li class="chapter" data-level="3.4.3" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#single-cell-portal"><i class="fa fa-check"></i><b>3.4.3</b> Single Cell Portal</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="understanding-sequencing-raw-data.html"><a href="understanding-sequencing-raw-data.html#docker-commands"><i class="fa fa-check"></i><b>3.5</b> Docker Commands</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="transcriptome-quantification.html"><a href="transcriptome-quantification.html"><i class="fa fa-check"></i><b>4</b> Transcriptome Quantification</a><ul>
<li class="chapter" data-level="4.1" data-path="transcriptome-quantification.html"><a href="transcriptome-quantification.html#google-slides"><i class="fa fa-check"></i><b>4.1</b> Google Slides</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html"><i class="fa fa-check"></i><b>5</b> Processing scRNAseq Data</a><ul>
<li class="chapter" data-level="5.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#goal"><i class="fa fa-check"></i><b>5.1</b> Goal</a></li>
<li class="chapter" data-level="5.2" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#further-reading"><i class="fa fa-check"></i><b>5.2</b> Further reading</a></li>
<li class="chapter" data-level="5.3" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#download-data"><i class="fa fa-check"></i><b>5.3</b> Download data</a><ul>
<li class="chapter" data-level="5.3.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#fastq-file-format"><i class="fa fa-check"></i><b>5.3.1</b> Fastq file format</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#align-the-reads"><i class="fa fa-check"></i><b>5.4</b> Align the reads</a><ul>
<li class="chapter" data-level="5.4.1" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#star-align"><i class="fa fa-check"></i><b>5.4.1</b> STAR align</a></li>
<li class="chapter" data-level="5.4.2" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#bam-file-format"><i class="fa fa-check"></i><b>5.4.2</b> Bam file format</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="processing-scrnaseq-data.html"><a href="processing-scrnaseq-data.html#visualization"><i class="fa fa-check"></i><b>5.5</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html"><i class="fa fa-check"></i><b>6</b> Introduction R/Bioconductor</a><ul>
<li class="chapter" data-level="6.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#start-environment"><i class="fa fa-check"></i><b>6.1</b> Start Environment</a><ul>
<li class="chapter" data-level="6.1.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#local-command"><i class="fa fa-check"></i><b>6.1.1</b> Local Command</a></li>
<li class="chapter" data-level="6.1.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#aws-command"><i class="fa fa-check"></i><b>6.1.2</b> AWS Command</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#installing-packages"><i class="fa fa-check"></i><b>6.2</b> Installing packages</a><ul>
<li class="chapter" data-level="6.2.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#cran"><i class="fa fa-check"></i><b>6.2.1</b> CRAN</a></li>
<li class="chapter" data-level="6.2.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#github"><i class="fa fa-check"></i><b>6.2.2</b> Github</a></li>
<li class="chapter" data-level="6.2.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#bioconductor"><i class="fa fa-check"></i><b>6.2.3</b> Bioconductor</a></li>
<li class="chapter" data-level="6.2.4" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#source"><i class="fa fa-check"></i><b>6.2.4</b> Source</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#installation-instructions"><i class="fa fa-check"></i><b>6.3</b> Installation instructions:</a><ul>
<li class="chapter" data-level="6.3.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#classestypes"><i class="fa fa-check"></i><b>6.3.1</b> Classes/Types</a></li>
<li class="chapter" data-level="6.3.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#data-structures"><i class="fa fa-check"></i><b>6.3.2</b> Data structures</a></li>
<li class="chapter" data-level="6.3.3" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#detour-to-s3s4"><i class="fa fa-check"></i><b>6.3.3</b> Detour to S3/S4</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#more-information"><i class="fa fa-check"></i><b>6.4</b> More information</a><ul>
<li class="chapter" data-level="6.4.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#checking-for-help-for-any-function"><i class="fa fa-check"></i><b>6.4.1</b> Checking for help for any function!</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#grammer-of-graphics-ggplot2"><i class="fa fa-check"></i><b>6.5</b> Grammer of Graphics (ggplot2)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#what-is-ggplot2"><i class="fa fa-check"></i><b>6.5.1</b> What is ggplot2?</a></li>
<li class="chapter" data-level="6.5.2" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#principles-of-ggplot2"><i class="fa fa-check"></i><b>6.5.2</b> Principles of ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="introduction-rbioconductor.html"><a href="introduction-rbioconductor.html#reference"><i class="fa fa-check"></i><b>6.6</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>7</b> Quality Control</a><ul>
<li class="chapter" data-level="7.1" data-path="quality-control.html"><a href="quality-control.html#slides-1"><i class="fa fa-check"></i><b>7.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html"><i class="fa fa-check"></i><b>8</b> Data Wrangling scRNAseq</a><ul>
<li class="chapter" data-level="8.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#goal-1"><i class="fa fa-check"></i><b>8.1</b> Goal</a></li>
<li class="chapter" data-level="8.2" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#introduction-2"><i class="fa fa-check"></i><b>8.2</b> Introduction</a><ul>
<li class="chapter" data-level="8.2.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#load-necessary-packages"><i class="fa fa-check"></i><b>8.2.1</b> Load necessary packages</a></li>
<li class="chapter" data-level="8.2.2" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#read-in-nsclc-counts-matrix."><i class="fa fa-check"></i><b>8.2.2</b> Read in NSCLC counts matrix.</a></li>
<li class="chapter" data-level="8.2.3" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#lets-examine-the-sparse-counts-matrix"><i class="fa fa-check"></i><b>8.2.3</b> Let’s examine the sparse counts matrix</a></li>
<li class="chapter" data-level="8.2.4" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#how-big-is-the-matrix"><i class="fa fa-check"></i><b>8.2.4</b> How big is the matrix?</a></li>
<li class="chapter" data-level="8.2.5" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#how-much-memory-does-a-sparse-matrix-take-up-relative-to-a-dense-matrix"><i class="fa fa-check"></i><b>8.2.5</b> How much memory does a sparse matrix take up relative to a dense matrix?</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#filtering-low-quality-cells"><i class="fa fa-check"></i><b>8.3</b> Filtering low-quality cells</a><ul>
<li class="chapter" data-level="8.3.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#look-at-the-summary-counts-for-genes-and-cells"><i class="fa fa-check"></i><b>8.3.1</b> Look at the summary counts for genes and cells</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#plot-cells-ranked-by-their-number-of-detected-genes."><i class="fa fa-check"></i><b>8.3.2</b> Plot cells ranked by their number of detected genes.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#beginning-with-seurat-httpsatijalab.orgseurat"><i class="fa fa-check"></i><b>8.4</b> Beginning with Seurat: <span>http://satijalab.org/seurat/</span></a><ul>
<li class="chapter" data-level="8.4.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#creating-a-seurat-object"><i class="fa fa-check"></i><b>8.4.1</b> Creating a seurat object</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#preprocessing-step-1-filter-out-low-quality-cells"><i class="fa fa-check"></i><b>8.5</b> Preprocessing step 1 : Filter out low-quality cells</a></li>
<li class="chapter" data-level="8.6" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#examine-contents-of-seurat-object"><i class="fa fa-check"></i><b>8.6</b> Examine contents of Seurat object</a><ul>
<li class="chapter" data-level="8.6.1" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#preprocessing-step-2-expression-normalization"><i class="fa fa-check"></i><b>8.6.1</b> Preprocessing step 2 : Expression normalization</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#detection-of-variable-genes-across-the-single-cells"><i class="fa fa-check"></i><b>8.7</b> Detection of variable genes across the single cells</a></li>
<li class="chapter" data-level="8.8" data-path="data-wrangling-scrnaseq.html"><a href="data-wrangling-scrnaseq.html#gene-set-expression-across-cells"><i class="fa fa-check"></i><b>8.8</b> Gene set expression across cells</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="identifying-cell-populations.html"><a href="identifying-cell-populations.html"><i class="fa fa-check"></i><b>9</b> Identifying Cell Populations</a><ul>
<li class="chapter" data-level="9.1" data-path="identifying-cell-populations.html"><a href="identifying-cell-populations.html#slides-2"><i class="fa fa-check"></i><b>9.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html"><i class="fa fa-check"></i><b>10</b> Feature Selection and Cluster Analysis</a><ul>
<li class="chapter" data-level="10.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#abstract"><i class="fa fa-check"></i><b>10.1</b> Abstract</a></li>
<li class="chapter" data-level="10.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#seurat-tutorial-redo"><i class="fa fa-check"></i><b>10.2</b> Seurat Tutorial Redo</a><ul>
<li class="chapter" data-level="10.2.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#preprocessing-steps"><i class="fa fa-check"></i><b>10.2.1</b> Preprocessing Steps</a></li>
<li class="chapter" data-level="10.2.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#start-of-identifying-cell-types"><i class="fa fa-check"></i><b>10.2.2</b> Start of Identifying Cell Types</a></li>
<li class="chapter" data-level="10.2.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#run-non-linear-dimensional-reduction-umaptsne"><i class="fa fa-check"></i><b>10.2.3</b> Run non-linear dimensional reduction (UMAP/tSNE)</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#feature-selection"><i class="fa fa-check"></i><b>10.3</b> Feature Selection</a><ul>
<li class="chapter" data-level="10.3.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#differential-expression-analysis"><i class="fa fa-check"></i><b>10.3.1</b> Differential Expression Analysis</a></li>
<li class="chapter" data-level="10.3.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#check-clusters"><i class="fa fa-check"></i><b>10.3.2</b> Check Clusters</a></li>
<li class="chapter" data-level="10.3.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#view-entire-object-structure"><i class="fa fa-check"></i><b>10.3.3</b> View Entire Object Structure</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#probabilistic-lda-clustering"><i class="fa fa-check"></i><b>10.4</b> Probabilistic (LDA) Clustering</a><ul>
<li class="chapter" data-level="10.4.1" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#example-lda-in-bulk"><i class="fa fa-check"></i><b>10.4.1</b> Example LDA in Bulk</a></li>
<li class="chapter" data-level="10.4.2" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#pbmc-lda"><i class="fa fa-check"></i><b>10.4.2</b> PBMC LDA</a></li>
<li class="chapter" data-level="10.4.3" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#practice-visualizingembedding"><i class="fa fa-check"></i><b>10.4.3</b> Practice Visualizing/Embedding</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="feature-selection-and-cluster-analysis.html"><a href="feature-selection-and-cluster-analysis.html#other-options-for-analysis"><i class="fa fa-check"></i><b>10.5</b> Other Options For Analysis</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="batch-correction-lecture.html"><a href="batch-correction-lecture.html"><i class="fa fa-check"></i><b>11</b> Batch Correction Lecture</a><ul>
<li class="chapter" data-level="11.1" data-path="batch-correction-lecture.html"><a href="batch-correction-lecture.html#slides-3"><i class="fa fa-check"></i><b>11.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html"><i class="fa fa-check"></i><b>12</b> Batch Correction Lab</a><ul>
<li class="chapter" data-level="12.1" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#load-settings-and-packages"><i class="fa fa-check"></i><b>12.1</b> Load settings and packages</a></li>
<li class="chapter" data-level="12.2" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#read-in-pancreas-expression-matrices"><i class="fa fa-check"></i><b>12.2</b> Read in pancreas expression matrices</a></li>
<li class="chapter" data-level="12.3" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#preparing-the-individual-seurat-objects-for-each-pancreas-dataset-without-batch-correction"><i class="fa fa-check"></i><b>12.3</b> Preparing the individual Seurat objects for each pancreas dataset without batch correction</a></li>
<li class="chapter" data-level="12.4" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#cluster-pancreatic-datasets-without-batch-correction"><i class="fa fa-check"></i><b>12.4</b> Cluster pancreatic datasets without batch correction</a><ul>
<li class="chapter" data-level="12.4.1" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#batch-correction-canonical-correlation-analysis-cca-mutual-nearest-neighbors-mnn-using-seurat-v3"><i class="fa fa-check"></i><b>12.4.1</b> Batch correction: canonical correlation analysis (CCA) + mutual nearest neighbors (MNN) using Seurat v3</a></li>
<li class="chapter" data-level="12.4.2" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#batch-correction-integrative-non-negative-matrix-factorization-nmf-using-liger"><i class="fa fa-check"></i><b>12.4.2</b> Batch correction: integrative non-negative matrix factorization (NMF) using LIGER</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#additional-exploration-regressing-out-unwanted-covariates"><i class="fa fa-check"></i><b>12.5</b> Additional exploration: Regressing out unwanted covariates</a></li>
<li class="chapter" data-level="12.6" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#additional-exploration-kbet"><i class="fa fa-check"></i><b>12.6</b> Additional exploration: kBET</a></li>
<li class="chapter" data-level="12.7" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#additional-exploration-seurat-3"><i class="fa fa-check"></i><b>12.7</b> Additional exploration: Seurat 3</a></li>
<li class="chapter" data-level="12.8" data-path="batch-correction-lab.html"><a href="batch-correction-lab.html#acknowledgements"><i class="fa fa-check"></i><b>12.8</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="trajectory-inference.html"><a href="trajectory-inference.html"><i class="fa fa-check"></i><b>13</b> Trajectory Inference</a><ul>
<li class="chapter" data-level="13.1" data-path="trajectory-inference.html"><a href="trajectory-inference.html#slides-4"><i class="fa fa-check"></i><b>13.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html"><i class="fa fa-check"></i><b>14</b> Trajectory Analysis</a><ul>
<li class="chapter" data-level="14.1" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#load-settings-and-packages-1"><i class="fa fa-check"></i><b>14.1</b> Load settings and packages</a></li>
<li><a href="trajectory-analysis.html#first-look-at-the-differentiation-data-from-deng-et-al.we-will-use-a-nice-smart-seq2-single-cell-rna-seq-data-from-single-cell-rna-seq-reveals-dynamic-random-monoallelic-gene-expression-in-mammalian-cells.-here-is-one-relevant-detail-from-their-paper-to-investigate-allele-specific-gene-expression-at-single-cell-resolution-we-isolated-269-individual-cells-dissociated-from-in-vivo-f1-embryos-casteij-c57bl6j-hereafter-abbreviated-as-cast-and-c57-respectively-from-oocyte-to-blastocyst-stages-of-mouse-preimplantation-development-pd"><span class="toc-section-number">14.2</span> First look at the differentiation data from Deng et
al. We will use a nice SMART-Seq2 single cell RNA-seq data from <span>Single-Cell RNA-Seq Reveals Dynamic, Random Monoallelic Gene Expression in Mammalian Cells</span>. Here is one relevant detail from their paper: “To investigate allele-specific gene expression at single-cell resolution, we isolated 269 individual cells dissociated from in vivo F1 embryos (CAST/EiJ × C57BL/6J, hereafter abbreviated as CAST and C57, respectively) from oocyte to blastocyst stages of mouse preimplantation development (PD)”</a></li>
<li class="chapter" data-level="14.3" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#principle-components-analysis"><i class="fa fa-check"></i><b>14.3</b> Principle Components Analysis</a></li>
<li class="chapter" data-level="14.4" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#diffusion-map-pseudotime"><i class="fa fa-check"></i><b>14.4</b> Diffusion map pseudotime</a></li>
<li class="chapter" data-level="14.5" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#slingshot-map-pseudotime"><i class="fa fa-check"></i><b>14.5</b> Slingshot map pseudotime</a></li>
<li class="chapter" data-level="14.6" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#find-temporally-expressed-genes"><i class="fa fa-check"></i><b>14.6</b> Find temporally expressed genes</a></li>
<li class="chapter" data-level="14.7" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#comparison-of-the-different-trajectory-inference-methods"><i class="fa fa-check"></i><b>14.7</b> Comparison of the different trajectory inference methods</a></li>
<li class="chapter" data-level="14.8" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#plots-of-gene-expression-over-time."><i class="fa fa-check"></i><b>14.8</b> Plots of gene expression over time.</a></li>
<li class="chapter" data-level="14.9" data-path="trajectory-analysis.html"><a href="trajectory-analysis.html#acknowledgements-1"><i class="fa fa-check"></i><b>14.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="mutli-omic-analysis.html"><a href="mutli-omic-analysis.html"><i class="fa fa-check"></i><b>15</b> Mutli-omic Analysis</a><ul>
<li class="chapter" data-level="15.1" data-path="mutli-omic-analysis.html"><a href="mutli-omic-analysis.html#slides-5"><i class="fa fa-check"></i><b>15.1</b> Slides</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="cite-seq.html"><a href="cite-seq.html"><i class="fa fa-check"></i><b>16</b> Cite-Seq</a><ul>
<li class="chapter" data-level="16.1" data-path="cite-seq.html"><a href="cite-seq.html#load-settings-and-packages-2"><i class="fa fa-check"></i><b>16.1</b> Load settings and packages</a></li>
<li class="chapter" data-level="16.2" data-path="cite-seq.html"><a href="cite-seq.html#load-in-the-data"><i class="fa fa-check"></i><b>16.2</b> Load in the data</a></li>
<li class="chapter" data-level="16.3" data-path="cite-seq.html"><a href="cite-seq.html#setup-a-seurat-object-and-cluster-cells-based-on-rna-expression"><i class="fa fa-check"></i><b>16.3</b> Setup a Seurat object, and cluster cells based on RNA expression</a></li>
<li class="chapter" data-level="16.4" data-path="cite-seq.html"><a href="cite-seq.html#add-the-protein-expression-levels-to-the-seurat-object"><i class="fa fa-check"></i><b>16.4</b> Add the protein expression levels to the Seurat object</a></li>
<li class="chapter" data-level="16.5" data-path="cite-seq.html"><a href="cite-seq.html#visualize-protein-levels-on-rna-clusters"><i class="fa fa-check"></i><b>16.5</b> Visualize protein levels on RNA clusters</a></li>
<li class="chapter" data-level="16.6" data-path="cite-seq.html"><a href="cite-seq.html#identify-differentially-expressed-proteins-between-clusters"><i class="fa fa-check"></i><b>16.6</b> Identify differentially expressed proteins between clusters</a></li>
<li class="chapter" data-level="16.7" data-path="cite-seq.html"><a href="cite-seq.html#cluster-directly-on-protein-levels"><i class="fa fa-check"></i><b>16.7</b> Cluster directly on protein levels</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="additional-exploration-another-example-of-multi-modal-analysis.html"><a href="additional-exploration-another-example-of-multi-modal-analysis.html"><i class="fa fa-check"></i><b>17</b> Additional exploration: another example of multi-modal analysis</a><ul>
<li class="chapter" data-level="17.1" data-path="additional-exploration-another-example-of-multi-modal-analysis.html"><a href="additional-exploration-another-example-of-multi-modal-analysis.html#acknowledgements-2"><i class="fa fa-check"></i><b>17.1</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="single-cell-resources.html"><a href="single-cell-resources.html"><i class="fa fa-check"></i><b>18</b> Single Cell Resources</a><ul>
<li class="chapter" data-level="18.1" data-path="single-cell-resources.html"><a href="single-cell-resources.html#comprehensive-list-of-single-cell-resources"><i class="fa fa-check"></i><b>18.1</b> Comprehensive list of single-cell resources</a></li>
<li class="chapter" data-level="18.2" data-path="single-cell-resources.html"><a href="single-cell-resources.html#computational-packages-for-single-cell-analysis"><i class="fa fa-check"></i><b>18.2</b> Computational packages for single-cell analysis</a></li>
<li class="chapter" data-level="18.3" data-path="single-cell-resources.html"><a href="single-cell-resources.html#elife-commentary-on-the-human-cell-atlas"><i class="fa fa-check"></i><b>18.3</b> eLife Commentary on the Human Cell Atlas</a></li>
<li class="chapter" data-level="18.4" data-path="single-cell-resources.html"><a href="single-cell-resources.html#online-courses"><i class="fa fa-check"></i><b>18.4</b> Online courses</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ANALYSIS OF SINGLE CELL RNA-SEQ DATA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="trajectory-analysis" class="section level1">
<h1><span class="header-section-number">14</span> Trajectory Analysis</h1>
<p>In this lab, we will analyze a single cell RNA-seq dataset that will teach us about several methods to infer the differentiation trajectory of a set of cells. These methods can order a set of individual cells along a path / trajectory / lineage, and assign a pseudotime value to each cell that represents where the cell is along that path. This can be a starting point for further analysis to determine gene expression programs driving interesting cell phenotypes. As you are running the code, think about how the algorithms work and what you like and do not like about the assumptions and utilities provided by the algorithm.</p>
<div id="load-settings-and-packages-1" class="section level2">
<h2><span class="header-section-number">14.1</span> Load settings and packages</h2>
</div>
<div id="first-look-at-the-differentiation-data-from-deng-et-al.we-will-use-a-nice-smart-seq2-single-cell-rna-seq-data-from-single-cell-rna-seq-reveals-dynamic-random-monoallelic-gene-expression-in-mammalian-cells.-here-is-one-relevant-detail-from-their-paper-to-investigate-allele-specific-gene-expression-at-single-cell-resolution-we-isolated-269-individual-cells-dissociated-from-in-vivo-f1-embryos-casteij-c57bl6j-hereafter-abbreviated-as-cast-and-c57-respectively-from-oocyte-to-blastocyst-stages-of-mouse-preimplantation-development-pd" class="section level2">
<h2><span class="header-section-number">14.2</span> First look at the differentiation data from Deng et
al. We will use a nice SMART-Seq2 single cell RNA-seq data from <a href="http://science.sciencemag.org/content/343/6167/193">Single-Cell RNA-Seq Reveals Dynamic, Random Monoallelic Gene Expression in Mammalian Cells</a>. Here is one relevant detail from their paper: “To investigate allele-specific gene expression at single-cell resolution, we isolated 269 individual cells dissociated from in vivo F1 embryos (CAST/EiJ × C57BL/6J, hereafter abbreviated as CAST and C57, respectively) from oocyte to blastocyst stages of mouse preimplantation development (PD)”</h2>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1"><span class="co"># Read in single cell data.</span></a>
<a class="sourceLine" id="cb247-2" data-line-number="2">path.deng &lt;-<span class="st"> </span><span class="kw">paste0</span>(mydir, <span class="st">&quot;deng-reads.rds&quot;</span>)</a>
<a class="sourceLine" id="cb247-3" data-line-number="3">deng_SCE &lt;-<span class="st"> </span><span class="kw">readRDS</span>(path.deng)</a>
<a class="sourceLine" id="cb247-4" data-line-number="4"></a>
<a class="sourceLine" id="cb247-5" data-line-number="5"><span class="co"># What class is the deng_SCE object, and how is it organized?</span></a>
<a class="sourceLine" id="cb247-6" data-line-number="6"><span class="kw">class</span>(deng_SCE)</a>
<a class="sourceLine" id="cb247-7" data-line-number="7"><span class="kw">structure</span>(deng_SCE)</a>
<a class="sourceLine" id="cb247-8" data-line-number="8"></a>
<a class="sourceLine" id="cb247-9" data-line-number="9"><span class="co"># How many mouse cells are at each stage?</span></a>
<a class="sourceLine" id="cb247-10" data-line-number="10"><span class="kw">table</span>(deng_SCE<span class="op">$</span>cell_type1)</a>
<a class="sourceLine" id="cb247-11" data-line-number="11"><span class="kw">table</span>(deng_SCE<span class="op">$</span>cell_type2)</a>
<a class="sourceLine" id="cb247-12" data-line-number="12"></a>
<a class="sourceLine" id="cb247-13" data-line-number="13"><span class="co"># Re-order the levels of the factor storing the cell developmental stage.</span></a>
<a class="sourceLine" id="cb247-14" data-line-number="14">deng_SCE<span class="op">$</span>cell_type2 &lt;-<span class="st"> </span><span class="kw">factor</span>(deng_SCE<span class="op">$</span>cell_type2,</a>
<a class="sourceLine" id="cb247-15" data-line-number="15">                              <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;zy&quot;</span>, <span class="st">&quot;early2cell&quot;</span>, <span class="st">&quot;mid2cell&quot;</span>, <span class="st">&quot;late2cell&quot;</span>, </a>
<a class="sourceLine" id="cb247-16" data-line-number="16">                                         <span class="st">&quot;4cell&quot;</span>, <span class="st">&quot;8cell&quot;</span>, <span class="st">&quot;16cell&quot;</span>, <span class="st">&quot;earlyblast&quot;</span>,</a>
<a class="sourceLine" id="cb247-17" data-line-number="17">                                         <span class="st">&quot;midblast&quot;</span>, <span class="st">&quot;lateblast&quot;</span>))</a></code></pre></div>
</div>
<div id="principle-components-analysis" class="section level2">
<h2><span class="header-section-number">14.3</span> Principle Components Analysis</h2>
<p>Let us take a first look at the Deng data. One simple approach to ordering cells in pseudotime is to use PCA. By carrying out PCA and labeling the cells by the stage at which they were collected, we can see how well the principal components separate cells along a differentiation trajectory.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1"><span class="co"># Run PCA on Deng data. Use the runPCA function from the SingleCellExperiment package.</span></a>
<a class="sourceLine" id="cb248-2" data-line-number="2">deng_SCE &lt;-<span class="st"> </span><span class="kw">runPCA</span>(deng_SCE, <span class="dt">ncomponents =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb248-3" data-line-number="3"></a>
<a class="sourceLine" id="cb248-4" data-line-number="4"><span class="co"># Use the reducedDim function to access the PCA and store the results. </span></a>
<a class="sourceLine" id="cb248-5" data-line-number="5">pca &lt;-<span class="st"> </span><span class="kw">reducedDim</span>(deng_SCE, <span class="st">&quot;PCA&quot;</span>)</a>
<a class="sourceLine" id="cb248-6" data-line-number="6"></a>
<a class="sourceLine" id="cb248-7" data-line-number="7"><span class="co"># Describe how the PCA is stored in a matrix. Why does it have this structure?</span></a>
<a class="sourceLine" id="cb248-8" data-line-number="8"><span class="kw">head</span>(pca)</a>
<a class="sourceLine" id="cb248-9" data-line-number="9"><span class="kw">dim</span>(pca)</a>
<a class="sourceLine" id="cb248-10" data-line-number="10"></a>
<a class="sourceLine" id="cb248-11" data-line-number="11"><span class="co"># Add PCA data to the deng_SCE object.</span></a>
<a class="sourceLine" id="cb248-12" data-line-number="12">deng_SCE<span class="op">$</span>PC1 &lt;-<span class="st"> </span>pca[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb248-13" data-line-number="13">deng_SCE<span class="op">$</span>PC2 &lt;-<span class="st"> </span>pca[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb248-14" data-line-number="14"></a>
<a class="sourceLine" id="cb248-15" data-line-number="15"><span class="co"># Plot PC biplot with cells colored by cell_type2. </span></a>
<a class="sourceLine" id="cb248-16" data-line-number="16"><span class="co"># colData(deng_SCE) accesses the cell metadata DataFrame object for deng_SCE.</span></a>
<a class="sourceLine" id="cb248-17" data-line-number="17"><span class="co"># Look at Figure 1A of the paper as a comparison to your PC biplot.</span></a>
<a class="sourceLine" id="cb248-18" data-line-number="18"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2, <span class="dt">color =</span> cell_type2)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-19" data-line-number="19"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb248-20" data-line-number="20"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;PC1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;PC2&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;PC biplot&quot;</span>)</a>
<a class="sourceLine" id="cb248-21" data-line-number="21"></a>
<a class="sourceLine" id="cb248-22" data-line-number="22"><span class="co"># PCA is a simple approach and can be good to compare to more complex algorithms </span></a>
<a class="sourceLine" id="cb248-23" data-line-number="23"><span class="co"># designed to capture differentiation processes. As a simple measure of pseudotime </span></a>
<a class="sourceLine" id="cb248-24" data-line-number="24"><span class="co"># we can use the coordinates of PC1.</span></a>
<a class="sourceLine" id="cb248-25" data-line-number="25"><span class="co"># Plot PC1 vs cell_type2. </span></a>
<a class="sourceLine" id="cb248-26" data-line-number="26">deng_SCE<span class="op">$</span>pseudotime_PC1 &lt;-<span class="st"> </span><span class="kw">rank</span>(deng_SCE<span class="op">$</span>PC1)  <span class="co"># rank cells by their PC1 score</span></a>
<a class="sourceLine" id="cb248-27" data-line-number="27"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_PC1, <span class="dt">y =</span> cell_type2, </a>
<a class="sourceLine" id="cb248-28" data-line-number="28">                                             <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-29" data-line-number="29"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-30" data-line-number="30"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb248-31" data-line-number="31"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;PC1&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-32" data-line-number="32"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by first principal component&quot;</span>)</a>
<a class="sourceLine" id="cb248-33" data-line-number="33"><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_PC1.png&quot;</span>))</a>
<a class="sourceLine" id="cb248-34" data-line-number="34"></a>
<a class="sourceLine" id="cb248-35" data-line-number="35"><span class="co"># Try separating the cell types using other PCs. How does the separation look?</span></a></code></pre></div>
</div>
<div id="diffusion-map-pseudotime" class="section level2">
<h2><span class="header-section-number">14.4</span> Diffusion map pseudotime</h2>
<p>Let us see how a more advance trajectory inference method, diffusion maps and diffusion pseudotime, performs at placing cells along the expected differentiation trajectory.</p>
<p><a href="https://en.wikipedia.org/wiki/Diffusion_map">Diffusion maps</a> were introduced by <a href="http://www.sciencedirect.com/science/article/pii/S1063520306000546">Ronald Coifman and Stephane Lafon</a>, and the underlying idea is to assume that the data are samples from a diffusion process. The method infers the low-dimensional manifold by estimating the eigenvalues and eigenvectors for the diffusion operator related to the data.</p>
<p><a href="https://academic.oup.com/bioinformatics/article/32/8/1241/1744143">Angerer et al</a> have applied the diffusion maps concept to the analysis of single-cell RNA-seq data to create an R package called <a href="http://bioconductor.org/packages/destiny">destiny</a>.</p>
<p>We will use two forms of pseudotime: the first diffusion component and the diffusion pseudotime.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1"><span class="co">#  Prepare a counts matrix with labeled rows and columns. </span></a>
<a class="sourceLine" id="cb249-2" data-line-number="2">deng &lt;-<span class="st"> </span><span class="kw">logcounts</span>(deng_SCE)  <span class="co"># access log-transformed counts matrix</span></a>
<a class="sourceLine" id="cb249-3" data-line-number="3">cellLabels &lt;-<span class="st"> </span>deng_SCE<span class="op">$</span>cell_type2</a>
<a class="sourceLine" id="cb249-4" data-line-number="4"><span class="kw">colnames</span>(deng) &lt;-<span class="st"> </span>cellLabels</a>
<a class="sourceLine" id="cb249-5" data-line-number="5"></a>
<a class="sourceLine" id="cb249-6" data-line-number="6"><span class="co"># Make a diffusion map.</span></a>
<a class="sourceLine" id="cb249-7" data-line-number="7">dm &lt;-<span class="st"> </span><span class="kw">DiffusionMap</span>(<span class="kw">t</span>(deng))</a>
<a class="sourceLine" id="cb249-8" data-line-number="8"></a>
<a class="sourceLine" id="cb249-9" data-line-number="9"><span class="co"># Optional: Try different sigma values when making diffusion map.</span></a>
<a class="sourceLine" id="cb249-10" data-line-number="10"><span class="co"># dm &lt;- DiffusionMap(t(deng), sigma = &quot;local&quot;)  # use local option to set sigma</span></a>
<a class="sourceLine" id="cb249-11" data-line-number="11"><span class="co"># sigmas &lt;- find_sigmas(t(deng), verbose = FALSE)  # find optimal sigma</span></a>
<a class="sourceLine" id="cb249-12" data-line-number="12"><span class="co"># dm &lt;- DiffusionMap(t(deng), sigma = optimal_sigma(sigmas))  </span></a>
<a class="sourceLine" id="cb249-13" data-line-number="13"></a>
<a class="sourceLine" id="cb249-14" data-line-number="14"><span class="co"># Plot diffusion component 1 vs diffusion component 2 (DC1 vs DC2). </span></a>
<a class="sourceLine" id="cb249-15" data-line-number="15">tmp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">DC1 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">1</span>],</a>
<a class="sourceLine" id="cb249-16" data-line-number="16">                  <span class="dt">DC2 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">2</span>],</a>
<a class="sourceLine" id="cb249-17" data-line-number="17">                  <span class="dt">Timepoint =</span> deng_SCE<span class="op">$</span>cell_type2)</a>
<a class="sourceLine" id="cb249-18" data-line-number="18"><span class="kw">ggplot</span>(tmp, <span class="kw">aes</span>(<span class="dt">x =</span> DC1, <span class="dt">y =</span> DC2, <span class="dt">colour =</span> Timepoint)) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-19" data-line-number="19"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb249-20" data-line-number="20"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion component 1&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb249-21" data-line-number="21"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Diffusion component 2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-22" data-line-number="22"><span class="st">    </span><span class="kw">theme_classic</span>()</a>
<a class="sourceLine" id="cb249-23" data-line-number="23"></a>
<a class="sourceLine" id="cb249-24" data-line-number="24"><span class="co"># Try plotting higher diffusion components against one another.</span></a>
<a class="sourceLine" id="cb249-25" data-line-number="25"></a>
<a class="sourceLine" id="cb249-26" data-line-number="26"><span class="co"># Next, let us use the first diffusion component (DC1) as a measure of pseudotime.</span></a>
<a class="sourceLine" id="cb249-27" data-line-number="27"><span class="co"># How does the separation by cell stage look?</span></a>
<a class="sourceLine" id="cb249-28" data-line-number="28">deng_SCE<span class="op">$</span>pseudotime_diffusionmap &lt;-<span class="st"> </span><span class="kw">rank</span>(<span class="kw">eigenvectors</span>(dm)[,<span class="dv">1</span>])    <span class="co"># rank cells by their dpt</span></a>
<a class="sourceLine" id="cb249-29" data-line-number="29"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb249-30" data-line-number="30">       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_diffusionmap, </a>
<a class="sourceLine" id="cb249-31" data-line-number="31">           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-32" data-line-number="32"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-33" data-line-number="33"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb249-34" data-line-number="34"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion component 1 (DC1)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-35" data-line-number="35"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by DC1&quot;</span>)</a>
<a class="sourceLine" id="cb249-36" data-line-number="36"><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_DC1.png&quot;</span>))</a>
<a class="sourceLine" id="cb249-37" data-line-number="37"></a>
<a class="sourceLine" id="cb249-38" data-line-number="38"><span class="co"># Plot eigenvalues of diffusion distance matrix. How many diffusion components would you use?</span></a>
<a class="sourceLine" id="cb249-39" data-line-number="39"><span class="co"># This is analagous to the PC elbow plot (scree plot) that we previously used to assess how </span></a>
<a class="sourceLine" id="cb249-40" data-line-number="40"><span class="co"># many PCs to use in downstream applications like clustering.</span></a>
<a class="sourceLine" id="cb249-41" data-line-number="41"><span class="kw">plot</span>(<span class="kw">eigenvalues</span>(dm), <span class="dt">ylim =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> <span class="st">&#39;Diffusion component (DC)&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;Eigenvalue&#39;</span>)</a>
<a class="sourceLine" id="cb249-42" data-line-number="42"></a>
<a class="sourceLine" id="cb249-43" data-line-number="43"><span class="co"># What happens if you run the diffusion map on the PCs? Why would one do this?</span></a>
<a class="sourceLine" id="cb249-44" data-line-number="44"><span class="kw">rownames</span>(pca) &lt;-<span class="st"> </span>cellLabels</a>
<a class="sourceLine" id="cb249-45" data-line-number="45">dm &lt;-<span class="st"> </span><span class="kw">DiffusionMap</span>(pca)</a>
<a class="sourceLine" id="cb249-46" data-line-number="46"></a>
<a class="sourceLine" id="cb249-47" data-line-number="47"><span class="co"># Diffusion pseudotime calculation. </span></a>
<a class="sourceLine" id="cb249-48" data-line-number="48"><span class="co"># Set index or tip of pseudotime calculation to be a zygotic cell (cell 268). </span></a>
<a class="sourceLine" id="cb249-49" data-line-number="49">dpt &lt;-<span class="st"> </span><span class="kw">DPT</span>(dm, <span class="dt">tips =</span> <span class="dv">268</span>)</a>
<a class="sourceLine" id="cb249-50" data-line-number="50"></a>
<a class="sourceLine" id="cb249-51" data-line-number="51"><span class="co"># Plot DC1 vs DC2 and color the cells by their inferred diffusion pseudotime.</span></a>
<a class="sourceLine" id="cb249-52" data-line-number="52"><span class="co"># We can accesss diffusion pseudotime via dpt$dpt.</span></a>
<a class="sourceLine" id="cb249-53" data-line-number="53">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">DC1 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">1</span>], <span class="dt">DC2 =</span> <span class="kw">eigenvectors</span>(dm)[, <span class="dv">2</span>], </a>
<a class="sourceLine" id="cb249-54" data-line-number="54">                 <span class="dt">dptval =</span> dpt<span class="op">$</span>dpt, <span class="dt">cell_type2 =</span> deng_SCE<span class="op">$</span>cell_type2)</a>
<a class="sourceLine" id="cb249-55" data-line-number="55">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DC1, <span class="dt">y =</span> DC2, <span class="dt">color =</span> dptval))</a>
<a class="sourceLine" id="cb249-56" data-line-number="56">p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> DC1, <span class="dt">y =</span> DC2, <span class="dt">color =</span> cell_type2))</a>
<a class="sourceLine" id="cb249-57" data-line-number="57">p &lt;-<span class="st"> </span><span class="kw">plot_grid</span>(p1, p2)</a>
<a class="sourceLine" id="cb249-58" data-line-number="58">p</a>
<a class="sourceLine" id="cb249-59" data-line-number="59"><span class="kw">save_plot</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/dpt_celltype.png&quot;</span>), p, <span class="dt">base_height =</span> <span class="dv">5</span>, <span class="dt">base_aspect_ratio =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb249-60" data-line-number="60"></a>
<a class="sourceLine" id="cb249-61" data-line-number="61"><span class="co"># Plot diffusion pseudotime vs timepoint. </span></a>
<a class="sourceLine" id="cb249-62" data-line-number="62"><span class="co"># Which separates the data better, DC1 or diffusion pseudotime?</span></a>
<a class="sourceLine" id="cb249-63" data-line-number="63">deng_SCE<span class="op">$</span>pseudotime_dpt &lt;-<span class="st"> </span><span class="kw">rank</span>(dpt<span class="op">$</span>dpt) </a>
<a class="sourceLine" id="cb249-64" data-line-number="64"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), </a>
<a class="sourceLine" id="cb249-65" data-line-number="65">       <span class="kw">aes</span>(<span class="dt">x =</span> pseudotime_dpt, </a>
<a class="sourceLine" id="cb249-66" data-line-number="66">           <span class="dt">y =</span> cell_type2, <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-67" data-line-number="67"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-68" data-line-number="68"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb249-69" data-line-number="69"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Diffusion map pseudotime (dpt)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-70" data-line-number="70"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb249-71" data-line-number="71"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by diffusion map pseudotime&quot;</span>)</a>
<a class="sourceLine" id="cb249-72" data-line-number="72"><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_dpt.png&quot;</span>))</a>
<a class="sourceLine" id="cb249-73" data-line-number="73"></a>
<a class="sourceLine" id="cb249-74" data-line-number="74"><span class="co"># Save current progress.</span></a>
<a class="sourceLine" id="cb249-75" data-line-number="75"><span class="kw">save</span>(deng_SCE, <span class="dt">file =</span> Rda.destiny.path)</a>
<a class="sourceLine" id="cb249-76" data-line-number="76"><span class="co"># To load the data, run the following command.</span></a>
<a class="sourceLine" id="cb249-77" data-line-number="77"><span class="co"># load(Rda.destiny.path)</span></a></code></pre></div>
</div>
<div id="slingshot-map-pseudotime" class="section level2">
<h2><span class="header-section-number">14.5</span> Slingshot map pseudotime</h2>
<p>Let us see how another advance trajectory inference method, Slingshot, performs at placing cells along the expected differentiation trajectory.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1"><span class="kw">library</span>(slingshot)</a>
<a class="sourceLine" id="cb250-2" data-line-number="2"><span class="kw">library</span>(Seurat)</a>
<a class="sourceLine" id="cb250-3" data-line-number="3"></a>
<a class="sourceLine" id="cb250-4" data-line-number="4"><span class="co"># load(Rda.destiny.path)</span></a>
<a class="sourceLine" id="cb250-5" data-line-number="5"></a>
<a class="sourceLine" id="cb250-6" data-line-number="6"><span class="co"># Read the Slingshot documentation (?slingshot) and then run Slingshot below. </span></a>
<a class="sourceLine" id="cb250-7" data-line-number="7"><span class="co"># Given your understanding of the algorithm and the documentation, what is one </span></a>
<a class="sourceLine" id="cb250-8" data-line-number="8"><span class="co"># major set of parameters we omitted here when running Slingshot?</span></a>
<a class="sourceLine" id="cb250-9" data-line-number="9">sce &lt;-<span class="st"> </span><span class="kw">slingshot</span>(deng_SCE, <span class="dt">reducedDim =</span> <span class="st">&#39;PCA&#39;</span>)  <span class="co"># no clusters</span></a>
<a class="sourceLine" id="cb250-10" data-line-number="10"></a>
<a class="sourceLine" id="cb250-11" data-line-number="11"><span class="co"># Plot PC1 vs PC2 colored by Slingshot pseudotime.</span></a>
<a class="sourceLine" id="cb250-12" data-line-number="12">colors &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="dv">50</span>, <span class="dt">alpha =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb250-13" data-line-number="13"><span class="kw">plot</span>(<span class="kw">reducedDims</span>(sce)<span class="op">$</span>PCA, <span class="dt">col =</span> colors[<span class="kw">cut</span>(sce<span class="op">$</span>slingPseudotime_<span class="dv">1</span>,<span class="dt">breaks=</span><span class="dv">50</span>)], <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">asp =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb250-14" data-line-number="14"><span class="kw">lines</span>(<span class="kw">SlingshotDataSet</span>(sce), <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb250-15" data-line-number="15"></a>
<a class="sourceLine" id="cb250-16" data-line-number="16"><span class="co"># Plot Slingshot pseudotime vs cell stage. </span></a>
<a class="sourceLine" id="cb250-17" data-line-number="17"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> sce<span class="op">$</span>slingPseudotime_<span class="dv">1</span>, <span class="dt">y =</span> cell_type2, </a>
<a class="sourceLine" id="cb250-18" data-line-number="18">                              <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-19" data-line-number="19"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-20" data-line-number="20"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb250-21" data-line-number="21"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Slingshot pseudotime&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-22" data-line-number="22"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by Slingshot pseudotime&quot;</span>)</a>
<a class="sourceLine" id="cb250-23" data-line-number="23"></a>
<a class="sourceLine" id="cb250-24" data-line-number="24"><span class="co"># Cluster cells using the Seurat workflow below.</span></a>
<a class="sourceLine" id="cb250-25" data-line-number="25">gcdata &lt;-<span class="st"> </span><span class="kw">CreateSeuratObject</span>(<span class="dt">counts =</span> <span class="kw">counts</span>(deng_SCE), <span class="dt">project =</span> <span class="st">&quot;slingshot&quot;</span>)</a>
<a class="sourceLine" id="cb250-26" data-line-number="26">gcdata &lt;-<span class="st"> </span><span class="kw">NormalizeData</span>(gcdata, <span class="dt">normalization.method =</span> <span class="st">&quot;LogNormalize&quot;</span>, <span class="dt">scale.factor =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb250-27" data-line-number="27">gcdata &lt;-<span class="st"> </span><span class="kw">FindVariableFeatures</span>(gcdata, <span class="dt">selection.method =</span> <span class="st">&quot;vst&quot;</span>, <span class="dt">nfeatures =</span> <span class="dv">2000</span>)</a>
<a class="sourceLine" id="cb250-28" data-line-number="28">gcdata &lt;-<span class="st"> </span><span class="kw">ScaleData</span>(<span class="dt">object =</span> gcdata, <span class="dt">do.center =</span> T, <span class="dt">do.scale =</span> F)</a>
<a class="sourceLine" id="cb250-29" data-line-number="29">gcdata &lt;-<span class="st"> </span><span class="kw">RunPCA</span>(gcdata, <span class="dt">features =</span> <span class="kw">VariableFeatures</span>(gcdata), <span class="dt">npcs =</span> <span class="dv">40</span>, <span class="dt">ndims.print =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">nfeatures.print =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb250-30" data-line-number="30"></a>
<a class="sourceLine" id="cb250-31" data-line-number="31"><span class="co"># Cluster the cells using the first twenty principal components.</span></a>
<a class="sourceLine" id="cb250-32" data-line-number="32">gcdata &lt;-<span class="st"> </span><span class="kw">FindNeighbors</span>(gcdata, <span class="dt">reduction =</span> <span class="st">&quot;pca&quot;</span>, <span class="dt">dims =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">k.param =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb250-33" data-line-number="33">gcdata &lt;-<span class="st"> </span><span class="kw">FindClusters</span>(gcdata, <span class="dt">resolution =</span> <span class="fl">0.6</span>, <span class="dt">algorithm =</span> <span class="dv">1</span>, <span class="dt">random.seed =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb250-34" data-line-number="34"></a>
<a class="sourceLine" id="cb250-35" data-line-number="35"><span class="co"># Add clustering information from Seurat to the deng_SCE object</span></a>
<a class="sourceLine" id="cb250-36" data-line-number="36">deng_SCE<span class="op">$</span>slingPseudotime_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>  <span class="co"># remove old slingshot pseudotime data</span></a>
<a class="sourceLine" id="cb250-37" data-line-number="37"><span class="kw">colData</span>(deng_SCE)<span class="op">$</span>Seurat_clusters &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">Idents</span>(gcdata))  <span class="co"># go from factor to character</span></a>
<a class="sourceLine" id="cb250-38" data-line-number="38"></a>
<a class="sourceLine" id="cb250-39" data-line-number="39"><span class="co"># Then run Slingshot using these cluster assignments.</span></a>
<a class="sourceLine" id="cb250-40" data-line-number="40">deng_SCE &lt;-<span class="st"> </span><span class="kw">slingshot</span>(deng_SCE, <span class="dt">clusterLabels =</span> <span class="st">&#39;Seurat_clusters&#39;</span>, <span class="dt">reducedDim =</span> <span class="st">&#39;PCA&#39;</span>)</a>
<a class="sourceLine" id="cb250-41" data-line-number="41"></a>
<a class="sourceLine" id="cb250-42" data-line-number="42"><span class="co"># Plot PC1 vs PC2 colored by Slingshot pseudotime.</span></a>
<a class="sourceLine" id="cb250-43" data-line-number="43">colors &lt;-<span class="st"> </span><span class="kw">rainbow</span>(<span class="dv">50</span>, <span class="dt">alpha =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb250-44" data-line-number="44"><span class="kw">plot</span>(<span class="kw">reducedDims</span>(deng_SCE)<span class="op">$</span>PCA, <span class="dt">col =</span> colors[<span class="kw">cut</span>(deng_SCE<span class="op">$</span>slingPseudotime_<span class="dv">1</span>,<span class="dt">breaks=</span><span class="dv">50</span>)], <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">asp =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb250-45" data-line-number="45"><span class="kw">lines</span>(<span class="kw">SlingshotDataSet</span>(deng_SCE), <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb250-46" data-line-number="46"></a>
<a class="sourceLine" id="cb250-47" data-line-number="47"><span class="co"># Plot Slingshot pseudotime vs cell stage. </span></a>
<a class="sourceLine" id="cb250-48" data-line-number="48"><span class="kw">ggplot</span>(<span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)), <span class="kw">aes</span>(<span class="dt">x =</span> slingPseudotime_<span class="dv">1</span>, <span class="dt">y =</span> cell_type2, </a>
<a class="sourceLine" id="cb250-49" data-line-number="49">                              <span class="dt">colour =</span> cell_type2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-50" data-line-number="50"><span class="st">    </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-51" data-line-number="51"><span class="st">    </span><span class="kw">scale_color_tableau</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb250-52" data-line-number="52"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Slingshot pseudotime&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Timepoint&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb250-53" data-line-number="53"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells ordered by Slingshot pseudotime&quot;</span>)</a>
<a class="sourceLine" id="cb250-54" data-line-number="54"><span class="kw">ggsave</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;/pseudotime_slingshot.png&quot;</span>))</a>
<a class="sourceLine" id="cb250-55" data-line-number="55"></a>
<a class="sourceLine" id="cb250-56" data-line-number="56"><span class="co"># Save current progress.</span></a>
<a class="sourceLine" id="cb250-57" data-line-number="57"><span class="kw">save</span>(deng_SCE, <span class="dt">file =</span> Rda.slingshot.path)</a>
<a class="sourceLine" id="cb250-58" data-line-number="58"><span class="co"># To load the data, run the following command.</span></a>
<a class="sourceLine" id="cb250-59" data-line-number="59"><span class="co"># load(Rda.slingshot.path)</span></a></code></pre></div>
</div>
<div id="find-temporally-expressed-genes" class="section level2">
<h2><span class="header-section-number">14.6</span> Find temporally expressed genes</h2>
<p>In this final analysis code chunk, we will identify temporally expressed genes, ie those genes whose expression is changing in a continuous manner over pseudotime. To do this, we will fit a GAM with a LOESS term for pseudotime. Functions for fitting and working with generalized additive models, as described in “Generalized Additive Models” (Hastie and Tibshirani, 1990).
<a href="https://multithreaded.stitchfix.com/blog/2015/07/30/gam/">Read more about GAMs</a></p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1"><span class="co"># Only look at the 1,000 most variable genes when identifying temporally expressesd genes.</span></a>
<a class="sourceLine" id="cb251-2" data-line-number="2"><span class="co"># Identify the variable genes by ranking all genes by their variance.</span></a>
<a class="sourceLine" id="cb251-3" data-line-number="3">Y &lt;-<span class="st"> </span><span class="kw">log2</span>(<span class="kw">counts</span>(deng_SCE) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb251-4" data-line-number="4">var1K &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">sort</span>(<span class="kw">apply</span>(Y, <span class="dv">1</span>, var), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>]</a>
<a class="sourceLine" id="cb251-5" data-line-number="5">Y &lt;-<span class="st"> </span>Y[var1K, ]  <span class="co"># only counts for variable genes</span></a>
<a class="sourceLine" id="cb251-6" data-line-number="6"></a>
<a class="sourceLine" id="cb251-7" data-line-number="7"><span class="co"># Fit GAM for each gene using pseudotime as independent variable.</span></a>
<a class="sourceLine" id="cb251-8" data-line-number="8">t &lt;-<span class="st"> </span>deng_SCE<span class="op">$</span>slingPseudotime_<span class="dv">1</span></a>
<a class="sourceLine" id="cb251-9" data-line-number="9">gam.pval &lt;-<span class="st"> </span><span class="kw">apply</span>(Y, <span class="dv">1</span>, <span class="cf">function</span>(z){</a>
<a class="sourceLine" id="cb251-10" data-line-number="10">  d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z=</span>z, <span class="dt">t=</span>t)</a>
<a class="sourceLine" id="cb251-11" data-line-number="11">  tmp &lt;-<span class="st"> </span><span class="kw">gam</span>(z <span class="op">~</span><span class="st"> </span><span class="kw">lo</span>(t), <span class="dt">data=</span>d)</a>
<a class="sourceLine" id="cb251-12" data-line-number="12">  p &lt;-<span class="st"> </span><span class="kw">summary</span>(tmp)[<span class="dv">4</span>][[<span class="dv">1</span>]][<span class="dv">1</span>,<span class="dv">5</span>]</a>
<a class="sourceLine" id="cb251-13" data-line-number="13">  p</a>
<a class="sourceLine" id="cb251-14" data-line-number="14">})</a>
<a class="sourceLine" id="cb251-15" data-line-number="15"></a>
<a class="sourceLine" id="cb251-16" data-line-number="16"><span class="co"># Identify genes with the most significant time-dependent model fit.</span></a>
<a class="sourceLine" id="cb251-17" data-line-number="17">topgenes &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">sort</span>(gam.pval, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>))[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>]  </a>
<a class="sourceLine" id="cb251-18" data-line-number="18"></a>
<a class="sourceLine" id="cb251-19" data-line-number="19"><span class="co"># Prepare and plot a heatmap of the top genes that vary their expression over pseudotime.</span></a>
<a class="sourceLine" id="cb251-20" data-line-number="20"><span class="kw">require</span>(clusterExperiment)</a>
<a class="sourceLine" id="cb251-21" data-line-number="21">heatdata &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(gcdata[[<span class="st">&#39;RNA&#39;</span>]]<span class="op">@</span>data[<span class="kw">rownames</span>(gcdata) <span class="op">%in%</span><span class="st"> </span>topgenes, <span class="kw">order</span>(t, <span class="dt">na.last =</span> <span class="ot">NA</span>)])</a>
<a class="sourceLine" id="cb251-22" data-line-number="22">heatclus &lt;-<span class="st"> </span><span class="kw">Idents</span>(gcdata)[<span class="kw">order</span>(t, <span class="dt">na.last =</span> <span class="ot">NA</span>)]</a>
<a class="sourceLine" id="cb251-23" data-line-number="23"><span class="kw">png</span>(<span class="kw">paste0</span>(mydir, <span class="st">&quot;heatmap_time_genes.png&quot;</span>), <span class="dt">width=</span><span class="dv">10</span>, <span class="dt">height=</span><span class="dv">10</span>, <span class="dt">units =</span> <span class="st">&quot;in&quot;</span>, <span class="dt">res=</span><span class="dv">200</span>)</a>
<a class="sourceLine" id="cb251-24" data-line-number="24"><span class="co"># ce &lt;- ClusterExperiment(heatdata, heatclus, transformation = log1p)</span></a>
<a class="sourceLine" id="cb251-25" data-line-number="25"><span class="co"># clusterExperiment::plotHeatmap(ce, clusterSamplesData = &quot;orderSamplesValue&quot;, visualizeData = &#39;transformed&#39;, cexRow = 1.5, fontsize = 15)</span></a>
<a class="sourceLine" id="cb251-26" data-line-number="26"><span class="kw">heatmap</span>(<span class="kw">log1p</span>(heatdata), <span class="dt">Colv =</span> <span class="ot">NA</span>, <span class="dt">ColSideColors =</span> <span class="kw">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;Set1&quot;</span>)[heatclus])</a>
<a class="sourceLine" id="cb251-27" data-line-number="27"><span class="kw">dev.off</span>()</a></code></pre></div>
</div>
<div id="comparison-of-the-different-trajectory-inference-methods" class="section level2">
<h2><span class="header-section-number">14.7</span> Comparison of the different trajectory inference methods</h2>
<p>How do the trajectories inferred by PCA, diffusion pseudotime, and slingshot pseudotime compare to one another?</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1"><span class="co"># Prepare data frame with different pseudotime measures.</span></a>
<a class="sourceLine" id="cb252-2" data-line-number="2">df_pseudotime &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">colData</span>(deng_SCE)[, <span class="kw">c</span>(<span class="st">&quot;pseudotime_PC1&quot;</span>, <span class="st">&quot;pseudotime_dpt&quot;</span>, <span class="st">&quot;slingPseudotime_1&quot;</span>)])</a>
<a class="sourceLine" id="cb252-3" data-line-number="3"><span class="kw">colnames</span>(df_pseudotime) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PC1&quot;</span>, <span class="st">&quot;diffusion&quot;</span>, <span class="st">&quot;slingshot&quot;</span>)</a>
<a class="sourceLine" id="cb252-4" data-line-number="4"></a>
<a class="sourceLine" id="cb252-5" data-line-number="5"><span class="co"># Plot correlation between different pseudotime measures.</span></a>
<a class="sourceLine" id="cb252-6" data-line-number="6"><span class="kw">corrplot.mixed</span>(<span class="kw">cor</span>(df_pseudotime, <span class="dt">use =</span> <span class="st">&quot;na.or.complete&quot;</span>), </a>
<a class="sourceLine" id="cb252-7" data-line-number="7">               <span class="dt">order =</span> <span class="st">&quot;hclust&quot;</span>, <span class="dt">tl.col =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb252-8" data-line-number="8">               <span class="dt">main =</span> <span class="st">&quot;Correlation matrix for pseudotime results&quot;</span>,</a>
<a class="sourceLine" id="cb252-9" data-line-number="9">               <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">3.1</span>, <span class="dv">0</span>))</a></code></pre></div>
</div>
<div id="plots-of-gene-expression-over-time." class="section level2">
<h2><span class="header-section-number">14.8</span> Plots of gene expression over time.</h2>
<p>Visualize how some of the temporally expressed genes change in time.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Obox5&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>, </a>
<a class="sourceLine" id="cb253-2" data-line-number="2">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb253-3" data-line-number="3">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb253-4" data-line-number="4"></a>
<a class="sourceLine" id="cb253-5" data-line-number="5"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Obox5&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;pseudotime_dpt&quot;</span>, </a>
<a class="sourceLine" id="cb253-6" data-line-number="6">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb253-7" data-line-number="7">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb253-8" data-line-number="8"></a>
<a class="sourceLine" id="cb253-9" data-line-number="9"><span class="kw">plotExpression</span>(deng_SCE, <span class="st">&quot;Obox5&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;slingPseudotime_1&quot;</span>, </a>
<a class="sourceLine" id="cb253-10" data-line-number="10">               <span class="dt">colour_by =</span> <span class="st">&quot;cell_type2&quot;</span>, <span class="dt">show_violin =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb253-11" data-line-number="11">               <span class="dt">show_smooth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="acknowledgements-1" class="section level2">
<h2><span class="header-section-number">14.9</span> Acknowledgements</h2>
<p>This document builds off chapter 8.4 from the <a href="https://scrnaseq-course.cog.sanger.ac.uk/website/biological-analysis.html">Analysis of single cell RNA-seq data</a>, from the <a href="https://bioconductor.org/packages/release/bioc/html/destiny.html">Destiny vignette</a> and from the <a href="https://www.bioconductor.org/packages/devel/bioc/vignettes/slingshot/inst/doc/slingshot.html">Slingshot vignette</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="trajectory-inference.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mutli-omic-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["2020_scWorkshop.pdf", "2020_scWorkshop.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
